var biggestObject={
    "Total population within the locality-Total":"B01003_001E",

    "Age distribution broken down by sex-Total":"B01001_001E",
    "Male":"B01001_002E",
    "Under 5 Years":"B01001_003E",
    "5 to 9 Years":"B01001_004E",
    "10 to 14 Years":"B01001_005E",
    "15 to 17 Years":"B01001_006E",
    "18 and 19 Years":"B01001_007E",
    "20 Years":"B01001_008E",
    "21 Years":"B01001_009E",
    "22 to 24 Years":"B01001_010E",
    "25 to 29 Years":"B01001_011E",
    "30 to 34 Years":"B01001_012E",
    "35 to 39 Years":"B01001_013E",
    "40 to 44 Years":"B01001_014E",
    "45 to 49 Years":"B01001_015E",
    "50 to 54 Years":"B01001_016E",
    "55 to 59 Years":"B01001_017E",
    "60 and 61 Years":"B01001_018E",
    "62 to 64 Years":"B01001_019E",
    "65 and 66 Years":"B01001_020E",
    "67 to 69 Years":"B01001_021E",
    "70 to 74 Years":"B01001_022E",
    "75 to 79 Years":"B01001_023E",
    "80 to 84 Years":"B01001_024E",
    "85 Years and over":"B01001_025E",
    "Female":"B01001_026E",
    "Under 5 Years":"B01001_027E",
    "5 to 9 Years":"B01001_028E",
    "10 to 14 Years":"B01001_029E",
    "15 to 17 Years":"B01001_030E",
    "18 and 19 Years":"B01001_031E",
    "20 Years":"B01001_032E",
    "21 Years":"B01001_033E",
    "22 to 24 Years":"B01001_034E",
    "25 to 29 Years":"B01001_035E",
    "30 to 34 Years":"B01001_036E",
    "35 to 39 Years":"B01001_037E",
    "40 to 44 Years":"B01001_038E",
    "45 to 49 Years":"B01001_039E",
    "50 to 54 Years":"B01001_040E",
    "55 to 59 Years":"B01001_041E",
    "60 and 61 Years":"B01001_042E",
    "62 to 64 Years":"B01001_043E",
    "65 and 66 Years":"B01001_044E",
    "67 to 69 Years":"B01001_045E",
    "70 to 74 Years":"B01001_046E",
    "75 to 79 Years":"B01001_047E",
    "80 to 84 Years":"B01001_048E",
    "85 Years and over":"B01001_049E",


    "Median Age by sex - Total":"B01002_001E",
    "Median Age - Male":"B01002_002E",
    "Median Age - Female":"B01002_003E",


    "Race-Total":"B02001_001E",
    "White Alone":"B02001_002E",
    "Black or African American Alone":"B02001_003E",
    "American Indian and Alaska Native Alone":"B02001_004E",
    "Asian Alone":"B02001_005E",
    "Native Hawaiian and Other Pacific Islander Alone":"B02001_006E",
    "Some Other Race Alone":"B02001_007E",
    "Two or More Races":"B02001_008E",
    "Two Races Including Some Other Race":"B02001_009E",
    "Two Races Excluding Some Other Race, and Three or More Races":"B02001_010E",


    "Living arrangement for adults (18 years and over)-Total":"B09021_001E",
    "Lives Alone":"B09021_002E",
    "Householder Living With Spouse or Spouse of Householder":"B09021_003E",
    "Householder Living With Unmarried Partner or Unmarried Partner of Householder":"B09021_004E",
    "Child of Householder":"B09021_005E",
    "Other Relatives":"B09021_006E",
    "Other Nonrelatives":"B09021_007E",
    "18 to 34 Years":"B09021_008E",
    "Lives Alone":"B09021_009E",
    "Householder Living With Spouse or Spouse of Householder":"B09021_010E",
    "Householder Living With Unmarried Partner or Unmarried Partner of Householder":"B09021_011E",
    "Child of Householder":"B09021_012E",
    "Other Relatives":"B09021_013E",
    "Other Nonrelatives":"B09021_014E",
    "35 to 64 Years":"B09021_015E",
    "Lives Alone":"B09021_016E",
    "Householder Living With Spouse or Spouse of Householder":"B09021_017E",
    "Householder Living With Unmarried Partner or Unmarried Partner of Householder":"B09021_018E",
    "Child of Householder":"B09021_019E",
    "Other Relatives":"B09021_020E",
    "Other Nonrelatives":"B09021_021E",
    "65 Years and over":"B09021_022E",
    "Lives Alone":"B09021_023E",
    "Householder Living With Spouse or Spouse of Householder":"B09021_024E",
    "Householder Living With Unmarried Partner or Unmarried Partner of Householder":"B09021_025E",
    "Child of Householder":"B09021_026E",
    "Other Relatives":"B09021_027E",
    "Other Nonrelatives":"B09021_028E",


    "Place of birth by nativity-Total":"C05002_001E",
    "Native":"C05002_002E",
    "Born in State of Residence":"C05002_003E",
    "Born in Other State in the United States":"C05002_004E",
    "Born Outside the United States":"C05002_005E",
    "Puerto Rico":"C05002_006E",
    "U.s. Island Areas or Born Abroad of American Parent(S)":"C05002_007E",
    "Foreign Born":"C05002_008E",

    "Median Household Income in the Past 12 Months (In 2015 Inflation-Adjusted Dollars)":"B19013_001E",

    "Per Capita Income in the Past 12 Months (In 2015 Inflation-Adjusted Dollars)":"B19301_001E",

    "Income to poverty-level ratio-Total":"B17002_001E",
    "Under .50":"B17002_002E",
    ".50 to .74":"B17002_003E",
    ".75 to .99":"B17002_004E",
    "1.00 to 1.24":"B17002_005E",
    "1.25 to 1.49":"B17002_006E",
    "1.50 to 1.74":"B17002_007E",
    "1.75 to 1.84":"B17002_008E",
    "1.85 to 1.99":"B17002_009E",
    "2.00 to 2.99":"B17002_010E",
    "3.00 to 3.99":"B17002_011E",
    "4.00 to 4.99":"B17002_012E",
    "5.00 and over":"B17002_013E",


    "Poverty level by place of birth-Total":"B06012_001E",
    "Below 100 Percent of the Poverty Level":"B06012_002E",
    "100 to 149 Percent of the Poverty Level":"B06012_003E",
    "At or Above 150 Percent of the Poverty Level":"B06012_004E",
    "Born in State of Residence":"B06012_005E",
    "Below 100 Percent of the Poverty Level":"B06012_006E",
    "100 to 149 Percent of the Poverty Level":"B06012_007E",
    "At or Above 150 Percent of the Poverty Level":"B06012_008E",
    "Born in Other State in the United States":"B06012_009E",
    "Below 100 Percent of the Poverty Level":"B06012_010E",
    "100 to 149 Percent of the Poverty Level":"B06012_011E",
    "At or Above 150 Percent of the Poverty Level":"B06012_012E",
    "Native; Born Outside the United States":"B06012_013E",
    "Below 100 Percent of the Poverty Level":"B06012_014E",
    "100 to 149 Percent of the Poverty Level":"B06012_015E",
    "At or Above 150 Percent of the Poverty Level":"B06012_016E",
    "Foreign Born":"B06012_017E",
    "Below 100 Percent of the Poverty Level":"B06012_018E",
    "100 to 149 Percent of the Poverty Level":"B06012_019E",
    "At or Above 150 Percent of the Poverty Level":"B06012_020E",

    "Educational attainment by place of birth-Total":"B06009_001E",
    "Less than High School Graduate":"B06009_002E",
    "High School Graduate (Includes Equivalency)":"B06009_003E",
    "Some College or Associate's Degree":"B06009_004E",
    "Bachelor's Degree":"B06009_005E",
    "Graduate or Professional Degree":"B06009_006E",
    "Born in State of Residence":"B06009_007E",
    "Less than High School Graduate":"B06009_008E",
    "High School Graduate (Includes Equivalency)":"B06009_009E",
    "Some College or Associate's Degree":"B06009_010E",
    "Bachelor's Degree":"B06009_011E",
    "Graduate or Professional Degree":"B06009_012E",
    "Born in Other State in the United States":"B06009_013E",
    "Less than High School Graduate":"B06009_014E",
    "High School Graduate (Includes Equivalency)":"B06009_015E",
    "Some College or Associate's Degree":"B06009_016E",
    "Bachelor's Degree":"B06009_017E",
    "Graduate or Professional Degree":"B06009_018E",
    "Native; Born Outside the United States":"B06009_019E",
    "Less than High School Graduate":"B06009_020E",
    "High School Graduate (Includes Equivalency)":"B06009_021E",
    "Some College or Associate's Degree":"B06009_022E",
    "Bachelor's Degree":"B06009_023E",
    "Graduate or Professional Degree":"B06009_024E",
    "Foreign Born":"B06009_025E",
    "Less than High School Graduate":"B06009_026E",
    "High School Graduate (Includes Equivalency)":"B06009_027E",
    "Some College or Associate's Degree":"B06009_028E",
    "Bachelor's Degree":"B06009_029E",
    "Graduate or Professional Degree":"B06009_030E",

    "Travel time to work-Total":"B08303_001E",
    "Less than 5 Minutes":"B08303_002E",
    "5 to 9 Minutes":"B08303_003E",
    "10 to 14 Minutes":"B08303_004E",
    "15 to 19 Minutes":"B08303_005E",
    "20 to 24 Minutes":"B08303_006E",
    "25 to 29 Minutes":"B08303_007E",
    "30 to 34 Minutes":"B08303_008E",
    "35 to 39 Minutes":"B08303_009E",
    "40 to 44 Minutes":"B08303_010E",
    "45 to 59 Minutes":"B08303_011E",
    "60 to 89 Minutes":"B08303_012E",
    "90 or More Minutes":"B08303_013E",

    "Means of transportation to work-Total":"B08301_001E",
    "Car, Truck, or Van":"B08301_002E",
    "Drove Alone":"B08301_003E",
    "Carpooled":"B08301_004E",
    "In 2-Person Carpool":"B08301_005E",
    "In 3-Person Carpool":"B08301_006E",
    "In 4-Person Carpool":"B08301_007E",
    "In 5- or 6-Person Carpool":"B08301_008E",
    "In 7-or-More-Person Carpool":"B08301_009E",
    "Public Transportation (Excluding Taxicab)":"B08301_010E",
    "Bus or Trolley Bus":"B08301_011E",
    "Streetcar or Trolley Car (Carro Publico in Puerto Rico)":"B08301_012E",
    "Subway or Elevated":"B08301_013E",
    "Railroad":"B08301_014E",
    "Ferryboat":"B08301_015E",
    "Taxicab":"B08301_016E",
    "Motorcycle":"B08301_017E",
    "Bicycle":"B08301_018E",
    "Walked":"B08301_019E",
    "Other Means":"B08301_020E",
    "Worked at Home":"B08301_021E",
}

var ageDistributionObjMale = {
    // "Male":"B01001_002E",
    "Under 5 Years":"B01001_003E",
    "5 to 9 Years":"B01001_004E",
    "10 to 14 Years":"B01001_005E",
    "15 to 17 Years":"B01001_006E",
    "18 and 19 Years":"B01001_007E",
    "20 Years":"B01001_008E",
    "21 Years":"B01001_009E",
    "22 to 24 Years":"B01001_010E",
    "25 to 29 Years":"B01001_011E",
    "30 to 34 Years":"B01001_012E",
    "35 to 39 Years":"B01001_013E",
    "40 to 44 Years":"B01001_014E",
    "45 to 49 Years":"B01001_015E",
    "50 to 54 Years":"B01001_016E",
    "55 to 59 Years":"B01001_017E",
    "60 and 61 Years":"B01001_018E",
    "62 to 64 Years":"B01001_019E",
    "65 and 66 Years":"B01001_020E",
    "67 to 69 Years":"B01001_021E",
    "70 to 74 Years":"B01001_022E",
    "75 to 79 Years":"B01001_023E",
    "80 to 84 Years":"B01001_024E",
    "85 Years and over":"B01001_025E"
}

var ageDistributionObjFemale={
    //"Female":"B01001_026E",
    "Under 5 Years":"B01001_027E",
    "5 to 9 Years":"B01001_028E",
    "10 to 14 Years":"B01001_029E",
    "15 to 17 Years":"B01001_030E",
    "18 and 19 Years":"B01001_031E",
    "20 Years":"B01001_032E",
    "21 Years":"B01001_033E",
    "22 to 24 Years":"B01001_034E",
    "25 to 29 Years":"B01001_035E",
    "30 to 34 Years":"B01001_036E",
    "35 to 39 Years":"B01001_037E",
    "40 to 44 Years":"B01001_038E",
    "45 to 49 Years":"B01001_039E",
    "50 to 54 Years":"B01001_040E",
    "55 to 59 Years":"B01001_041E",
    "60 and 61 Years":"B01001_042E",
    "62 to 64 Years":"B01001_043E",
    "65 and 66 Years":"B01001_044E",
    "67 to 69 Years":"B01001_045E",
    "70 to 74 Years":"B01001_046E",
    "75 to 79 Years":"B01001_047E",
    "80 to 84 Years":"B01001_048E",
    "85 Years and over":"B01001_049E"
}

var medianAgeBySexObj = {
    "Median Age Male":"B01002_002E",
    "Median Age Female":"B01002_003E"
}



var bigObject = {
    "Total population within the locality": "B01003_001E",
    "Age distribution broken down by sex": "B01001_001E",
    "Median age by sex": "B01002_001E",
    "Race": "B02001_001E",
    "Living arrangement for adults (18 years and over)": "B09021_001E",
    "Place of birth by nativity": "C05002_001E",
    "Median household income": "B19013_001E",
    "Per capita income": "B193010_01E",
    "Income to poverty-level ratio": "B170020_01E",
    "Poverty level by place of birth": "B060120_01E",
    "Educational attainment by place of birth": "B060090_01E",
    "Travel time to work": "B083030_01E",
    "Means of transportation to work": "B083010_01E",
    "Race - White Alone": "B02001_002E",
    "Place of birth by nativity - Native": "C05002_002E",
    "Income to poverty-level ratio under .50": "B17002_002E",
    "Means of transportation to work - Car/Van/Truck": "B08301_002E",
    "Means of transportation to work - Public transportation": "B08301_010E"
}
/******************************Aziz code integration 1***********************************/
var dictionary = {
    "Total population within the locality": "B01003_001E",
    "Age distribution broken down by sex": "B01001_001E",
    "Median age by sex": "B01002_001E",
    "Race": "B02001_001E",
    "Living arrangement for adults (18 years and over)": "B09021_001E",
    "Place of birth by nativity": "C05002_001E",
    "Median household income": "B19013_001E",
    "Per capita income": "B193010_01E",
    "Income to poverty-level ratio": "B170020_01E",
    "Poverty level by place of birth": "B060120_01E",
    "Educational attainment by place of birth": "B060090_01E",
    "Travel time to work": "B083030_01E",
    "Means of transportation to work": "B083010_01E"
};

var eightMapObj = {

    "Total population within the locality": "B01003_001E",
    "Median age by sex": "B01002_001E",
    "Median household income": "B19013_001E",
    "Race - White Alone": "B02001_002E",
    "Place of birth by nativity - Native": "C05002_002E",
    "Income to poverty-level ratio under .50": "B17002_002E",
    "Means of transportation to work - Car/Van/Truck": "B08301_002E",
    "Means of transportation to work - Public transportation": "B08301_010E"
}

var apiKey = "576299d4bf73993515a4994ffe79fcee7fe72b09";

// for(var eachObj in eightMapObj){
queue()
    .defer(d3.json, "http://bl.ocks.org/mbostock/raw/4090846/us.json")
    .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME,B01003_001E&for=state:*&key=" + apiKey)
    .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME,B01002_001E&for=state:*&key=" + apiKey)
    .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME,B19013_001E&for=state:*&key=" + apiKey)
    .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME,B02001_002E&for=state:*&key=" + apiKey)
    .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME,C05002_002E&for=state:*&key=" + apiKey)
    .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME,B17002_002E&for=state:*&key=" + apiKey)
    .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME,B08301_002E&for=state:*&key=" + apiKey)
    .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME,B08301_010E&for=state:*&key=" + apiKey)
    .await(getMapsData);

var pop1 = [];
var pop2 = [];
var age1 = [];
var age2 = [];
var inc1 = [];
var inc2 = [];
var rac1 = [];
var rac2 = [];
var nat1 = [];
var nat2 = [];
var pov1 = [];
var pov2 = [];
var car1 = [];
var car2 = [];
var ptr1 = [];
var ptr2 = [];


function getMapsData(error, usjson, totalPopulation, medianAge, medianIncome, race, native, poverty, carTran, publicTran) {

    totalPopulation.splice(0, 1);
    totalPopulation.forEach(function(index) {
        if (index[1] > 0) {
            pop1.push(parseInt(index[1])); //value
            pop2.push(parseInt(index[2])); //state id
        }
    });

    medianAge.splice(0, 1);
    medianAge.forEach(function(index) {
        if (index[1] > 0) {
            age1.push(Math.floor(parseInt(index[1])));
            age2.push(parseInt(index[2]));
        }
    });

    medianIncome.splice(0, 1);
    medianIncome.forEach(function(index) {
        if (index[1] > 0) {
            inc1.push(Math.floor(parseInt(index[1])));
            inc2.push(parseInt(index[2]));
        }
    });

    race.splice(0, 1);
    race.forEach(function(index) {
        if (index[1] > 0) {
            rac1.push(Math.floor(parseInt(index[1])));
            rac2.push(parseInt(index[2]));
        }
    });

    native.splice(0, 1);
    native.forEach(function(index) {
        if (index[1] > 0) {
            nat1.push(Math.floor(parseInt(index[1])));
            nat2.push(parseInt(index[2]));
        }
    });

    poverty.splice(0, 1);
    poverty.forEach(function(index) {
        if (index[1] > 0) {
            pov1.push(Math.floor(parseInt(index[1])));
            pov2.push(parseInt(index[2]));
        }
    });

    carTran.splice(0, 1);
    carTran.forEach(function(index) {
        if (index[1] > 0) {
            car1.push(Math.floor(parseInt(index[1])));
            car2.push(parseInt(index[2]));
        }
    });

    publicTran.splice(0, 1);
    publicTran.forEach(function(index) {
        if (index[1] > 0) {
            ptr1.push(Math.floor(parseInt(index[1])));
            ptr2.push(parseInt(index[2]));
        }
    });

    var totalPopArr = [];
    var medianAgeArr = [];
    var medianIncomeArr = [];
    var raceArr = [];
    var nativeArr = [];
    var povertyArr = [];
    var carTranArr = [];
    var publicTranArr = [];
    medianAgeArr.push(age1);
    medianAgeArr.push(age2);
    medianIncomeArr.push(inc1);
    medianIncomeArr.push(inc2);
    totalPopArr.push(pop1);
    totalPopArr.push(pop2);
    raceArr.push(rac1);
    raceArr.push(rac2);
    nativeArr.push(nat1);
    nativeArr.push(nat2);
    povertyArr.push(pov1);
    povertyArr.push(pov2);
    carTranArr.push(car1);
    carTranArr.push(car2);
    publicTranArr.push(ptr1);
    publicTranArr.push(ptr2);

    // logging data
    console.log("totalPopArr and medianAgeArr for 8 maps", totalPopArr, medianAgeArr);
    //function start here

    drawEightMaps('#eight-map-1', '#totalPopulationMap', totalPopArr);
    drawEightMaps('#eight-map-2', '#totalMedianAgeMap', medianAgeArr);
    drawEightMaps('#eight-map-3', '#totalMedianIncomeMap', medianIncomeArr);
    drawEightMaps('#eight-map-4', '#totalRaceMap', raceArr);
    drawEightMaps('#eight-map-5', '#totalNativeMap', nativeArr);
    drawEightMaps('#eight-map-6', '#totalPovertyMap', povertyArr);
    drawEightMaps('#eight-map-7', '#totalCarMap', carTranArr);
    drawEightMaps('#eight-map-8', '#totalPublicMap', publicTranArr);

    function drawEightMaps(mapID, svgId, totalValueArr) {

        var outerWidth = 280;
        var outerHeight = 350;
        var margin = {
            left: 20,
            top: 20,
            right: 20,
            bottom: 20
        };

        var innerWidth = outerWidth - margin.left - margin.right;
        var innerHeight = outerHeight - margin.top - margin.bottom;
        var svg = d3.select(mapID).append("svg")
            .attr("width", outerWidth)
            .attr("height", outerHeight)
            .attr("id",svgId);

        var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        //linear scale for linear gradient from color1 to color2
        var quantize = d3.scale.linear()
            .domain([d3.min(totalValueArr[0]), d3.max(totalValueArr[0])])
            .range(["#f7fcfd", "#00441b"]);

        var projection = d3.geo.albersUsa()
            .scale(300)
            .translate([innerWidth / 2, innerHeight / 2]);

        var path = d3.geo.path()
            .projection(projection);

        svg.append("g")
            .attr("class", "legendLinear")
            .attr("transform", "translate(50,290)");

        var legendLinear = d3.legend.color()
            .shapeWidth(30)
            .orient('horizontal')
            .cells(5)
            .labelFormat(d3.format('.2s'))
            .scale(quantize);

        /**
         * tooltip code trial
         */
        var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {

                var prop = totalValueArr[0][totalValueArr[1].indexOf(d.id)];

                var index = parseFloat([totalValueArr[1].indexOf(d.id)]);

                return  + "<span>" + d3.format('.2s')(prop) + "<span>";

            });
        /**
         * tooltip code ends
         */

        svg.call(tip);
        svg.select(".legendLinear")
            .call(legendLinear);

        //to show state borders only
        svg.append("g")
            .selectAll("path")
            .data(topojson.feature(usjson, usjson.objects.states).features)
            .enter().append("path")
            .attr("d", path)
            .style("fill", function(d) {
                return quantize(totalValueArr[0][totalValueArr[1].indexOf(d.id)]);
            }).classed("states", "true")
            .on("mouseover", tip.show)
            .on("mouseleave", tip.hide);
    } //function end here

} //8 maps data function ends here


/**************************Aziz integration end 1**********************************/

var scselection = "state";
var stateNameObj = [];
var countyNameObj = [];
var us, one;
var scselection; //state or county selection
var dataselection; //dataset selection
var svg = d3.select("#choropeth"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

$(document).ready(function() {
    //console.log(window.innerWidth,window.innerHeight);
    scselection = $('#disptype input:radio:checked').val();
    $("#addDataSetNameHere").text("Total Population within the locality");
    queue()
        .defer(d3.json, "js/us.json")
        .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME,B01003_001E&for=state:*&key="+apiKey)
        .await(ready);
});

function ready(error, us1, data1) {
    us = us1;
    one = data1;
    drawMap(null, one);
}

//for each of 13 variable selection
$("input[name=datasettype]").change(function() {
    var t = $('#level1dataset input:radio:checked').val();
    $("#" + t).removeClass("hidden");
    $("#" + t).addClass("activemenu");
    $('#level1dataset').addClass("hidden")
    $('#menuback').removeClass('hidden');
    $("#" + t + " label:first-child").click();
});

//back menu show/hide
$("#menuback").click(function() {
    $(".activemenu").addClass("hidden");
    $('#level1dataset').removeClass("hidden");
    $(".activemenu").removeClass("activemenu");
    $('#menuback').addClass('hidden');
});

//first level of each variables
$("input[name=dataset]").change(function() {
    var str = this.value;
    dataselection = str;
    scselection = $('#disptype input:radio:checked').val();
    queue()
        .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME," + dataselection + "&for=" + scselection + ":*&key="+apiKey)
        .await(drawMap);
});

//state county selection change
$("input[name=disp]").change(function() {
    dataselection = $('#' + $('#level1dataset input:radio:checked').val() + ' input:radio:checked').val();
    scselection = $('#disptype input:radio:checked').val();
    queue()
        .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME," + dataselection + "&for=" + scselection + ":*&key="+apiKey)
        .await(drawMap);
});

//for scatter plot
$("#gotoscatter").click(function(){
    window.location.href = "indexscatter.html";
});

//ELusive drawMap function begins here
function drawMap(error, usdata) {

    /**********aziz code added for name section*******************************/

        //add name values in the top section of the map
    $("#level1dataset input").on('change', function() {
        var text = $("#level1dataset input:checked").parent().text();
        console.log(text);
        $('#addDataSetNameHere').text(text);
    });

    $("#dataset2 input").on('change', function() {
        var text2 = $("#dataset2 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Age distribution broken down by sex >" + text2);
    });

    $("#dataset3 input").on('change', function() {
        var text2 = $("#dataset3 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Median age by sex >" + text2);
    });

    $("#dataset4 input").on('change', function() {
        var text2 = $("#dataset4 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Race >" + text2);
    });

    $("#dataset5 input").on('change', function() {
        var text2 = $("#dataset5 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Living arrangement for adults (18 years and over) >" + text2);
    });

    $("#dataset6 input").on('change', function() {
        var text2 = $("#dataset6 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Place of birth by nativity >" + text2);
    });

    $("#dataset7 input").on('change', function() {
        var text2 = $("#dataset7 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Median household income >" + text2);
    });

    $("#dataset8 input").on('change', function() {
        var text2 = $("#dataset8 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Per capita income >" + text2);
    });

    $("#dataset9 input").on('change', function() {
        var text2 = $("#dataset9 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Income to poverty-level ratio >" + text2);
    });

    $("#dataset10 input").on('change', function() {
        var text2 = $("#dataset10 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Poverty level by place of birth >" + text2);
    });

    $("#dataset11 input").on('change', function() {
        var text2 = $("#dataset11 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Educational attainment by place of birth >" + text2);
    });

    $("#dataset12 input").on('change', function() {
        var text2 = $("#dataset12 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Travel time to work >" + text2);
    });

    $("#dataset13 input").on('change', function() {
        var text2 = $("#dataset13 input:checked").parent().text();
        console.log(text2);
        $('#addDataSetNameHere').text("Means of transportation to work >" + text2);
    });

    //add name values done.
    /**********aziz code added for name section ends*******************************/

    var d = [],
        d1 = [];

    if (scselection == "county") {

        //state / county active toggleClass
        $('#stateLabel').removeClass('btn-primary');
        $('#stateLabel').addClass('btn-default');
        $('#countyLabel').addClass('btn-primary');
        $('#countyLabel').removeClass('btn-default');

        usdata.splice(0, 1);
        countyNameObj.length = 0;
        usdata.forEach(function(element) {
            var nameObj = {};
            if(element[1] == null){
                element[1] = 0;
                //console.log("null value here");
                //nameObj[Math.floor(element[1])] = element[0];
            }else{
                nameObj[Math.floor(element[1])] = element[0];
                nameObj.stateID = element[2];
                nameObj.countyID = element[3];
                countyNameObj.push(nameObj);
                if (element[1] > 0)
                    d.push(parseInt(element[1]));
                if (element[1] > 0)
                    d1.push(parseInt(element[2] + element[3]));
            }
        });
    }//if close here

//else state is selected
    else {

        //state/county active toggle
        $('#stateLabel').addClass('btn-primary');
        $('#stateLabel').removeClass('btn-default');
        $('#countyLabel').removeClass('btn-primary');
        $('#countyLabel').addClass('btn-default');

        usdata.splice(0, 1);
        stateNameObj.length = 0;
        usdata.forEach(function(element) {
            var nameObj = {};
            nameObj.id = element[2];
            nameObj[Math.floor(element[1])] = element[0]; //for age variables
            nameObj[element[2]] = element[0];
            stateNameObj.push(nameObj);
            if (element[1] > 0)
                d.push(parseInt(element[1]));
            if (element[1] > 0)
                d1.push(parseInt(element[2]));
        });
    } //else close here

    var arr = [];
    arr.push(d);
    arr.push(d1);


    //linear scale for linear gradient from color1 to color2
    var quantize = d3.scale.linear()
        .domain([d3.min(arr[0]), d3.max(arr[0])])
        .range(["#f7fcfd", "#00441b"]);

    var projection = d3.geo.albersUsa()
        .scale(750)
        .translate([width / 2.5, height / 3]);

    var path = d3.geo.path()
        .projection(projection);

    svg.selectAll('g').remove();

    if (scselection == "county") {

        svg.append("g")
            .attr("class", "legendLinear")
            .attr("transform", "translate(800,80)");

        var legendLinear = d3.legend.color()
            .shapeWidth(30)
            .orient('vertical')
            .cells(10)
            .labelFormat(d3.format('.2s'))
            .scale(quantize);


        var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {

                var prop = arr[0][arr[1].indexOf(d.id)];
                //console.log("prop for race",prop);
                var index = parseFloat([arr[1].indexOf(d.id)]);
                //console.log("index for race",index);
                //console.log("countyNameObj",countyNameObj[index][prop]);
                //console.log("countyNameObj here",countyNameObj);
                return "<strong>" + countyNameObj[index][prop] + " : </strong> <span>" + d3.format('.2s')(prop) + "<span>";
            });


        svg.call(tip);
        svg.select(".legendLinear")
            .call(legendLinear);

        //to show county borders
        svg.append("g")
            .attr("transform", "translate(0,40)")
            .attr("class", "counties")
            .selectAll("path")
            .data(topojson.feature(us, us.objects.counties).features)
            .enter().append("path")
            .style("fill", function(d) {
                return quantize(arr[0][arr[1].indexOf(d.id)]);
            })
            .attr("d", path)
            .on("mouseover", tip.show)
            .on("mouseleave", tip.hide)
            /**************************** modal code integration on click************************/
            //aziz integration code 2
            .on('click', function(d) {

                // d3.select('#mainBarChartCounty').selectAll('g').remove();
                // d3.select('#mainBarChartCounty2').selectAll('g').remove();

                var onClickCountyName = [];
                var prop = arr[0][arr[1].indexOf(d.id)]; //prop returns me the value (i.e population,age,etc)
                //console.log("prop of county", prop);
                var index = parseFloat([arr[1].indexOf(d.id)]); //index of d.id in arr[1]
                //console.log("index county", index);
                var countyName = countyNameObj[index][prop];
                //console.log("countyNameObjArray",countyNameObj);
                //get the selected county Id;
                // var idCounty = countyNameObj[index][countyName];
                //var idCounty = countyNameObj[index][countyName];
                for(var name in dictionary){
                    if(dictionary[name] == dataselection){
                        $("#modal-title-county").text(countyName+" | "+name+ " - " +prop);
                    }
                }
                //modal code for county - start
                $("#modal-section-county").modal('show');

                console.log("index", countyNameObj[index]);
                //console.log("idCounty", idCounty);
                onClickCountyName.push(countyName);
                console.log("countyName",countyName);
                /*********************************************************************************
                 age distribution by sex on click modal code
                 *********************************************************************************/
                //for age distribution by sex

                //console.log("objectKeys",objectKeys);

                if(dataselection == "B01001_001E"){

                    var ageDistributionObjMaleArray = [];
                    var ageDistributionMaleValues = [];
                    var ageDistributionObjFemaleArray = [];
                    var ageDistributionFemaleValues = [];
                    var objectKeys = Object.keys(ageDistributionObjMale);

                    // d3.select('#mainBarChartCounty').selectAll('g').remove();
                    // d3.select('#mainBarChartCounty2').selectAll('g').remove();

                    for(var attr in ageDistributionObjMale){
                        queue()
                            .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + ageDistributionObjMale[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
                            .await(getCountyData);
                    }

                    for(var attr in ageDistributionObjFemale){
                        queue()
                            .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + ageDistributionObjFemale[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID+"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
                            .await(getCountyData2);
                    }
                }
                function getCountyData(error,data){

                    var oneObj = {};
                    oneObj.sex = "Male";
                    data.splice(0,1);
                    data.forEach(function(index){
                        oneObj.population = Math.floor(index[1]);
                        ageDistributionMaleValues.push(oneObj.population);
                    });

                    ageDistributionObjMaleArray.push(oneObj);

                    for(var i =0;i<ageDistributionObjMaleArray.length;i++){
                        var obj = ageDistributionObjMaleArray[i];
                        obj.ageGroup = objectKeys[i];
                    }
// xCol,yCol,colorCol,xLabel,yLabel
                    if(ageDistributionObjMaleArray.length == 23){
                        drawBarChartCounty(ageDistributionObjMaleArray,ageDistributionMaleValues,'#mainBarChartCounty','ageGroup','population','sex','Age Group','Population');
                    }
                }//end function getCountyData

                function getCountyData2(error,data){

                    var oneObj = {};
                    oneObj.sex = "Female";
                    data.splice(0,1);
                    data.forEach(function(index){
                        oneObj.population = Math.floor(index[1]);
                        ageDistributionFemaleValues.push(oneObj.population);
                    });

                    ageDistributionObjFemaleArray.push(oneObj);

                    for(var i =0;i<ageDistributionObjFemaleArray.length;i++){
                        var obj = ageDistributionObjFemaleArray[i];
                        obj.ageGroup = objectKeys[i];
                    }

                    if(ageDistributionObjFemaleArray.length == 23){
                        drawBarChartCounty(ageDistributionObjFemaleArray,ageDistributionFemaleValues,'#mainBarChartCounty2','ageGroup','population','sex','Age Group','Population');
                    }
                }//end function getCountyData2

                /*********************************************************************************
                 age distribution by sex on click modal code ends
                 *********************************************************************************/

                /*********************************************************************************
                 median age distribution on click modal code starts here
                 *********************************************************************************/

                //console.log(medianObjectKeys);
                if(dataselection === "B01002_001E"){
                    //
                    // d3.select('#mainBarChartCounty').selectAll('g').remove();
                    // d3.select('#mainBarChartCounty2').selectAll('g').remove();
                    var medianAgeTotalObjArray = [];
                    var medianAgeTotalValuesArray = [];
                    var medianObjectKeys = Object.keys(medianAgeBySexObj);

                    for(var attr in medianAgeBySexObj){
                        queue()
                            .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + medianAgeBySexObj[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
                            .await(getCountyData3);
                    }
                }
                function getCountyData3(error,data){
                    var oneObj = {};
                    oneObj.name = countyNameObj[index][prop];
                    data.splice(0,1);
                    data.forEach(function(index){
                        oneObj.age = Math.floor(index[1]);
                        medianAgeTotalValuesArray.push(oneObj.age);
                    });

                    medianAgeTotalObjArray.push(oneObj);
                    //  console.log(medianAgeTotalObjArray);
                    for(var i=0;i<medianAgeTotalObjArray.length;i++){
                        var obj = medianAgeTotalObjArray[i];
                        obj.sex = medianObjectKeys[i];
                        if(i==0){
                            obj.gender = "male";
                        }
                        else{
                            obj.gender = "female";
                        }
                    }

                    if(medianAgeTotalObjArray.length == 2){
                        d3.select('#mainBarChartCounty2').selectAll('g').remove();
                        drawBarChartCounty(medianAgeTotalObjArray,medianAgeTotalValuesArray,'#mainBarChartCounty','sex','age','name','Sex','Median Age');
                    }
                }//end function getCountyData2


                /*********************************************************************************
                 median age distribution on click modal code ends here
                 *********************************************************************************/

                /*********************************************************************************
                 race distribution on click modal code starts here
                 *********************************************************************************/

                if(dataselection === 'B02001_001E'){


                    var raceObject = {

                        "White Alone":"B02001_002E",
                        "Black or African American Alone":"B02001_003E",
                        "American Indian and Alaska Native Alone":"B02001_004E",
                        "Asian Alone":"B02001_005E",
                        "Native Hawaiian and Other Pacific Islander Alone":"B02001_006E",
                        "Some Other Race Alone":"B02001_007E",
                        "Two or More Races":"B02001_008E"

                    }

                    var raceObject2 = {
                        "Two Races Including Some Other Race":"B02001_009E",
                        "Two Races Excluding Some Other Race, and Three or More Races":"B02001_010E"
                    }

                    var raceObjectKeys = Object.keys(raceObject);
                    var raceObjectKeys2 = Object.keys(raceObject2);
                    //console.log("race object keys",raceObjectKeys);

                    var raceObjArray = [];
                    var raceTotalValues = [];
                    var raceObjArray2 = [];
                    var raceTotalValues2 = [];

                    // console.log(("in race selection"));
                    for(var attr in raceObject){
                        queue()
                            .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + raceObject[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
                            .await(getRaceCountyData);
                    }
                    for(var attr in raceObject2){
                        queue()
                            .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + raceObject2[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
                            .await(getRaceCountyData2);
                    }
                }
                function getRaceCountyData(error,data){
                    // console.log("in getRaceCountyData");
                    var oneObj = {};
                    // oneObj.sex = "Female";
                    oneObj.name = countyNameObj[index][prop];
                    data.splice(0,1);
                    data.forEach(function(index){
                        // if(index[1] == null){}
                        oneObj.population = Math.floor(index[1]);
                        raceTotalValues.push(oneObj.population);
                    });

                    raceObjArray.push(oneObj);
                    //console.log(raceObjArray);
                    for(var i =0;i<raceObjArray.length;i++){
                        var obj = raceObjArray[i];
                        obj.race = raceObjectKeys[i];
                    }

                    if(raceObjArray.length === 7){
                        drawBarChartCounty(raceObjArray,raceTotalValues,'#mainBarChartCounty','race','population','name','Races','Population');
                    }
                }//end function getRaceCountyData

                function getRaceCountyData2(error,data){
                    // console.log("in getRaceCountyData");
                    var oneObj = {};
                    // oneObj.sex = "Female";
                    oneObj.name = countyNameObj[index][prop];
                    data.splice(0,1);
                    data.forEach(function(index){
                        // if(index[1] == null){}
                        oneObj.population = Math.floor(index[1]);
                        raceTotalValues2.push(oneObj.population);
                    });

                    raceObjArray2.push(oneObj);
                    //console.log(raceObjArray);
                    for(var i =0;i<raceObjArray2.length;i++){
                        var obj = raceObjArray2[i];
                        obj.race = raceObjectKeys2[i];
                    }

                    if(raceObjArray2.length === 2){
                        drawBarChartCounty(raceObjArray2,raceTotalValues2,'#mainBarChartCounty2','race','population','name','Races','Population');
                    }
                }//end function getRaceCountyData2


                /*********************************************************************************
                 race distribution on click modal code ends here
                 *********************************************************************************/


                /*********************************************************************************
                 living arrangement on click modal code starts here
                 *********************************************************************************/

                if(dataselection === "B09021_001E"){

                    var living1 = {
                        "Lives Alone":"B09021_009E",
                        "Householder Living With Spouse or Spouse of Householder":"B09021_010E",
                        "Householder Living With Unmarried Partner or Unmarried Partner of Householder":"B09021_011E",
                        "Child of Householder":"B09021_012E",
                        "Other Relatives":"B09021_013E",
                        "Other Nonrelatives":"B09021_014E"
                    }

                    var living2 = {
                        "Lives Alone":"B09021_016E",
                        "Householder Living With Spouse or Spouse of Householder":"B09021_017E",
                        "Householder Living With Unmarried Partner or Unmarried Partner of Householder":"B09021_018E",
                        "Child of Householder":"B09021_019E",
                        "Other Relatives":"B09021_020E",
                        "Other Nonrelatives":"B09021_021E"
                    }

                    var livingKey1 = Object.keys(living1);
                    var livingKey2 = Object.keys(living2);
                    var livingObjArray1 = [];
                    var livingTotalValues1 = [];
                    var livingObjArray2 = [];
                    var livingTotalValues2 = [];

                    for(var attr in livingKey1){
                        queue()
                            .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + livingKey1[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
                            .await(getLivingCountyData);
                    }
                    for(var attr in livingKey2){
                        queue()
                            .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + livingKey2[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
                            .await(getLivingCountyData2);
                    }
                }
                function getLivingCountyData(error,data){
// console.log("in getRaceCountyData");
                    var oneObj = {};
                    // oneObj.sex = "Female";
                    oneObj.ageGroup = "18 to 34 years";
                    data.splice(0,1);
                    data.forEach(function(index){
                        oneObj.population = Math.floor(index[1]);
                        livingTotalValues1.push(oneObj.population);
                    });

                    livingObjArray1.push(oneObj);
                    for(var i =0;i<livingObjArray1.length;i++){
                        var obj = livingObjArray1[i];
                        obj.livingArrangement = livingKey1[i];
                    }

                    if(livingObjArray1.length == 6){
                        drawBarChartCounty(livingObjArray1,livingTotalValues1,'#mainBarChartCounty','livingArrangement','population','ageGroup','Arrangement','Population');
                    }
                }//end function getRaceCountyData

                function getLivingCountyData2(error,data){
                    // console.log("in getRaceCountyData");
                    var oneObj = {};
                    // oneObj.sex = "Female";
                    oneObj.ageGroup = "35 to 64 years";
                    data.splice(0,1);
                    data.forEach(function(index){
                        // if(index[1] == null){}
                        oneObj.population = Math.floor(index[1]);
                        livingTotalValues2.push(oneObj.population);
                    });

                    livingObjArray2.push(oneObj);
                    for(var i =0;i<livingObjArray2.length;i++){
                        var obj = livingObjArray2[i];
                        obj.livingArrangement = livingKey2[i];
                    }

                    if(livingObjArray2.length === 6){
                        drawBarChartCounty(livingObjArray2,livingTotalValues2,'#mainBarChartCounty2','livingArrangement','population','name','arrangement','Population');
                    }
                }//end function getLivingCountyData2

                /*********************************************************************************
                 livingArrangement on click modal code ends here
                 *********************************************************************************/

                 /*********************************************************************************
                  travel time to work on click modal code starts here
                  *********************************************************************************/
if(dataselection == 'B08303_001E'){
console.log('in travle time');

  var travelTimeObj = {
    "Less than 5 Minutes":"B08303_002E",
    "5 to 9 Minutes":"B08303_003E",
    "10 to 14 Minutes":"B08303_004E",
    "15 to 19 Minutes":"B08303_005E",
    "20 to 24 Minutes":"B08303_006E",
    "25 to 29 Minutes":"B08303_007E",
    "30 to 34 Minutes":"B08303_008E",
    "35 to 39 Minutes":"B08303_009E",
    "40 to 44 Minutes":"B08303_010E",
    "45 to 59 Minutes":"B08303_011E",
    "60 to 89 Minutes":"B08303_012E",
    "90 or More Minutes":"B08303_013E"
  }

var travelTimeKeys = Object.keys(travelTimeObj);
var travelTimeObjArray = [];
var travelTimeValues = [];

for(var attr in travelTimeObj){
    queue()
        .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + travelTimeObj[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
        .await(getTravelTimeCountyData);
}
}//close if

function getTravelTimeCountyData(error,data){

    var oneObj = {};
    oneObj.name = countyNameObj[index][prop];
    data.splice(0,1);
    data.forEach(function(index){
        oneObj.population = Math.floor(index[1]);
        travelTimeValues.push(oneObj.population);
    });

    travelTimeObjArray.push(oneObj);

    for(var i =0;i<travelTimeObjArray.length;i++){
        var obj = travelTimeObjArray[i];
        obj.travelTime = travelTimeKeys[i];
    }

    if(travelTimeObjArray.length == 12){
      d3.select('#mainBarChartCounty2').selectAll('g').remove();
      $('#modal-title-county').text(countyNameObj[index][prop] + " | Travel Time to Work");
    drawBarChartCounty(travelTimeObjArray,travelTimeValues,'#mainBarChartCounty','travelTime','population','name','Travel Time','Population');
    }

}//end function getTravelTimeCountyData

                  /*********************************************************************************
                   means of transportation to work on click modal code starts here
                   *********************************************************************************/
if(dataselection == 'B08301_001E'){
console.log("in means of transport");

  var meansOfTransport = {

     "Car, Truck, or Van":"B08301_002E",
     "Drove Alone":"B08301_003E",
     "Carpooled":"B08301_004E",
     "In 2-Person Carpool":"B08301_005E",
     "In 3-Person Carpool":"B08301_006E",
     "In 4-Person Carpool":"B08301_007E",
     "In 5- or 6-Person Carpool":"B08301_008E",
     "In 7-or-More-Person Carpool":"B08301_009E",
     "Public Transportation (Excluding Taxicab)":"B08301_010E",
     "Bus or Trolley Bus":"B08301_011E",
     "Streetcar or Trolley Car (Carro Publico in Puerto Rico)":"B08301_012E",
     "Subway or Elevated":"B08301_013E",
     "Railroad":"B08301_014E",
     "Ferryboat":"B08301_015E",
     "Taxicab":"B08301_016E",
     "Motorcycle":"B08301_017E",
     "Bicycle":"B08301_018E",
     "Walked":"B08301_019E",
     "Other Means":"B08301_020E",
     "Worked at Home":"B08301_021E"

  }

  var transportKeys = Object.keys(meansOfTransport);
  var transportObjArray = [];
  var transportValues = [];

  for(var attr in meansOfTransport){
      queue()
          .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + meansOfTransport[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
          .await(getTransportCountyData);
  }

}//close if

function getTransportCountyData(error,data){
  var oneObj = {};
  oneObj.name = countyNameObj[index][prop];
  data.splice(0,1);
  data.forEach(function(index){
      oneObj.population = Math.floor(index[1]);
      transportValues.push(oneObj.population);
  });

  transportObjArray.push(oneObj);

  for(var i =0;i<transportObjArray.length;i++){
      var obj = transportObjArray[i];
      obj.transportType = transportKeys[i];
  }

  if(transportObjArray.length == 20){
    d3.select('#mainBarChartCounty2').selectAll('g').remove();
    $('#modal-title-county').text(countyNameObj[index][prop] + " | Means of Transport to Work");
  drawBarChartCounty(transportObjArray,transportValues,'#mainBarChartCounty','transportType','population','name','Means of Transportation','Population');
  }
}
                   /*********************************************************************************
                    means of transportationon click modal code ends here
                    *********************************************************************************/

                    /*********************************************************************************
                     income to poverty level click modal code starts here
                     *********************************************************************************/

if(dataselection == "B17002_001E"){

var incomeToPovertyObj = {

  "Under .50":"B17002_002E",
  ".50 to .74":"B17002_003E",
  ".75 to .99":"B17002_004E",
  "1.00 to 1.24":"B17002_005E",
  "1.25 to 1.49":"B17002_006E",
  "1.50 to 1.74":"B17002_007E",
  "1.75 to 1.84":"B17002_008E",
  "1.85 to 1.99":"B17002_009E",
  "2.00 to 2.99":"B17002_010E",
  "3.00 to 3.99":"B17002_011E",
  "4.00 to 4.99":"B17002_012E",
  "5.00 and over":"B17002_013E"

}

var intpKeys = Object.keys(incomeToPovertyObj);
var intpObjArray = [];
var intpValues = [];

for(var attr in incomeToPovertyObj){
    queue()
        .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + incomeToPovertyObj[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
        .await(getIntpCountyData);
}

}//close if

function getIntpCountyData(error,data){
var oneObj = {};
oneObj.name = countyNameObj[index][prop];
data.splice(0,1);
data.forEach(function(index){
    oneObj.population = Math.floor(index[1]);
    intpValues.push(oneObj.population);
});

intpObjArray.push(oneObj);

for(var i =0;i<intpObjArray.length;i++){
    var obj = intpObjArray[i];
    obj.ratio = intpKeys[i];
}

if(intpObjArray.length == intpKeys.length){
  d3.select('#mainBarChartCounty2').selectAll('g').remove();
  $('#modal-title-county').text(countyNameObj[index][prop] + " | Income to poverty level ratio");
drawBarChartCounty(intpObjArray,intpValues,'#mainBarChartCounty','ratio','population','name','Income to poverty level ratio','Population');
}
}
/*********************************************************************************
 income to poverty level click modal code ends here
 *********************************************************************************/

 /*********************************************************************************
  Place of birth by nativity click modal code starts here
  *********************************************************************************/

  if(dataselection == "C05002_001E"){

  var placeOfBirthObj = {

    "Native":"C05002_002E",
    "Born in State of Residence":"C05002_003E",
    "Born in Other State in the United States":"C05002_004E",
    "Born Outside the United States":"C05002_005E",
    "Puerto Rico":"C05002_006E",
    "U.s. Island Areas or Born Abroad of American Parent(S)":"C05002_007E",
    "Foreign Born":"C05002_008E"

  }

  var pobKeys = Object.keys(placeOfBirthObj);
  var pobObjArray = [];
  var pobValues = [];

  for(var attr in placeOfBirthObj){
      queue()
          .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + placeOfBirthObj[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
          .await(getpobCountyData);
  }

  }//close if

  function getpobCountyData(error,data){
  var oneObj = {};
  oneObj.name = countyNameObj[index][prop];
  data.splice(0,1);
  data.forEach(function(index){
      oneObj.population = Math.floor(index[1]);
      pobValues.push(oneObj.population);
  });

  pobObjArray.push(oneObj);

  for(var i =0;i<pobObjArray.length;i++){
      var obj = pobObjArray[i];
      obj.pob = pobKeys[i];
  }

  if(pobObjArray.length == pobKeys.length){
    d3.select('#mainBarChartCounty2').selectAll('g').remove();
    $('#modal-title-county').text(countyNameObj[index][prop] + " | Place of Birth by Nativity");
  drawBarChartCounty(pobObjArray,pobValues,'#mainBarChartCounty','pob','population','name','Place of Birth by Nativity','Population');
  }
  }

  /*********************************************************************************
   Place of birth by nativity click modal code ends here
   *********************************************************************************/

   /*********************************************************************************
    Poverty Level by place of birth click modal code starts here
    *********************************************************************************/
if(dataselection == "B06012_001E"){

var povObjArray = [];
var povObjValues = [];

var povInState = {

  "Below 100 Percent of the Poverty Level":"B06012_006E",
  "100 to 149 Percent of the Poverty Level":"B06012_007E",
  "At or Above 150 Percent of the Poverty Level":"B06012_008E"

}

var povInStateKeys = Object.keys(povInState);

for(var attr in povInState){
  queue()
    .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + povInState[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
    .await(getPovStateCounty);
}

}//close if

function getPovStateCounty(error,data){
  var obj = {};
  obj.name = "Born in State of Residence";
  data.splice(0,1);
  data.forEach(function(index){
    obj.population = index[1];
    povObjValues.push(obj.population);
  });
  povObjArray.push(obj);
  console.log("povObjArray",povObjArray);
}

for(var i=0;i<povObjArray.length;i++){
    var obj = povObjArray[i];
    obj.level = povInStateKeys[i];
}

var PovertyLevelByPlaceOfBirthObj = {

  "Born in State of Residence":"B06012_005E",

  "Below 100 Percent of the Poverty Level":"B06012_006E",
  "100 to 149 Percent of the Poverty Level":"B06012_007E",
  "At or Above 150 Percent of the Poverty Level":"B06012_008E",

  "Born in Other State in the United States":"B06012_009E",

  "Below 100 Percent of the Poverty Level":"B06012_010E",
  "100 to 149 Percent of the Poverty Level":"B06012_011E",
  "At or Above 150 Percent of the Poverty Level":"B06012_012E",

  "Native; Born Outside the United States":"B06012_013E",

  "Below 100 Percent of the Poverty Level":"B06012_014E",
  "100 to 149 Percent of the Poverty Level":"B06012_015E",
  "At or Above 150 Percent of the Poverty Level":"B06012_016E",

  "Foreign Born":"B06012_017E",

  "Below 100 Percent of the Poverty Level":"B06012_018E",
  "100 to 149 Percent of the Poverty Level":"B06012_019E",
  "At or Above 150 Percent of the Poverty Level":"B06012_020E"

}


// var povBigObjArray = [];
//
// for(var j=0;j<3;j++){
//
//   var povObj = {};
//
//   povObj.name = "Born in State of Residence";
//   povObj.level = povInStateKeys[j];
//
// queue()
//   .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + povInState[povObj.level] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
//   .await(ready);
//
// function ready(error,data){
//   data.splice(0,1);
//   console.log(data);
//   data.forEach(function(index){
//     povObj.population = index[1];
//     povBigObjArray.push(povObj);
//   });
//   console.log(povBigObjArray);
// }
// }//for loop end



    // $.ajax({
    //   url: "http://api.census.gov/data/2015/acs1?get=NAME," + povInState[povObj.level] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey,
    //   success: function(data){
    //     data.splice(0,1);
    //     data.forEach(function(element){
    //       povObj.population = parseInt(element[1]);
    //     });
    //   },
    //   complete: function(){
    //       i++;
    //       povBigObjArray.push(povObj);
    //
    //   }
    // });




    /*********************************************************************************
      Poverty Level by place of birth click modal code ends here
     *********************************************************************************/

                //function drawBarChartCounty begins here
                function drawBarChartCounty(totalObjectArray, totalPopulationArray, svgId,xCol,yCol,colorCol,xLabel,yLabel) {

                    //clear contents of old chart
                    d3.select(svgId).selectAll('g').remove();

                    var svg = d3.select(svgId);
                    var margin = {
                        top: 20,
                        right: 100,
                        bottom: 100,
                        left: 40
                    };

                    var width = svg.attr("width") - margin.left - margin.right;
                    var height = svg.attr("height") - margin.top - margin.bottom;

                    var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                    var barPadding = 0;

                    var xColumn = xCol;
                    var yColumn = yCol;
                    var colorColumn = colorCol;
                    var layerColumn = colorColumn;

                    var xScale = d3.scale.ordinal().rangeBands([0, width], barPadding);
                    var yScale = d3.scale.linear().domain([d3.min(totalPopulationArray),
                        d3.max(totalPopulationArray)
                    ]).range([height, 0]);

                    var colorScale = d3.scale.category10();

                    // add the tooltip area to the webpage
                    var tooltip = d3.select("body").append("div")
                        .attr("class", "tooltip")
                        .style("opacity", 0);

                    var xAxis = d3.svg.axis()
                        .scale(xScale)
                        .orient('bottom')
                    // .tickValues("transform", "rotate(90)");

                    var yAxis = d3.svg.axis()
                        .scale(yScale)
                        .orient('left')
                        .tickFormat(d3.format('.2s'))

                    var colorLegend = d3.legend.color();

                    colorLegend.scale(colorScale)
                        .shapePadding(2)
                        .shapeWidth(14)
                        .shapeHeight(14)
                        .labelOffset(4);

                    var xAxisG = g.append("g")
                        .attr('class', 'x axis')
                        .attr('transform', 'translate(0,' + height + ')')

                    //.call(xAxis);

                    var yAxisG = g.append("g")
                        .attr('class', 'y axis')

                    //.call(yAxis);

                    //appending color lengend
                    var colorLegendG = g.append("g")
                        .attr("class", "color-legend")
                        .attr("transform", "translate(725,0)");

                    //adding labels
                    g.append("g")
                        .append("text")
                        .attr("transform", "rotate(0)")
                        .attr("x", 5)
                        .attr("y", -15)
                        .attr("dy", ".71em")
                        .style("text-anchor", "end")
                        .style('font-size', "9px")
                        .text(yLabel);

                    g.append("g")
                        .append("text")
                        .attr("transform", "rotate(0)")
                        .attr("x", 750)
                        .attr("y", 180)
                        .attr("dx", ".71em")
                        .style("text-anchor", "end")
                        .style('font-size', "9px")
                        .text(xLabel);
                    //end of adding labels

                    //render function begins
                    function render(data) {
                        var nested = d3.nest()
                            .key(function(d) {
                                return d[colorColumn]
                            })
                            .entries(data);

                        console.log("barchart nested", nested);

                        var stack = d3.layout.stack()
                            .y(function(d) {
                                return d[yColumn];
                            })
                            .values(function(d) {
                                return d.values;
                            })

                        var layers = stack(nested);

                        console.log("layers", layers);

                        xScale.domain(layers[0].values.map(function(d) {
                            return d[xColumn];
                        }));

                        colorScale.domain(layers.map(function(layer) {
                            return layer.key;
                        }));

                        xAxisG.call(xAxis).selectAll("text")
                            .style("text-anchor", "start")
                            .style("font-size", "9px")
                            .attr("dx", "0.5em")
                            .attr("dy", ".15em")
                            .attr("transform", "rotate(65)");

                        yAxisG.call(yAxis).selectAll('text').style("font-size", "9px");

                        var layers = g.selectAll(".layer").data(layers);
                        layers.enter().append("g").attr("class", "layer");
                        layers.exit().remove();
                        layers.style("fill", function(d) {
                            return colorScale(d.key);
                        });

                        var bars = layers.selectAll("rect").data(function(d) {
                            return d.values;
                        });

                        // var barWidth = xScale.rangeBand() / 2 colorScale.domain().length;
                        var barWidth = xScale.rangeBand() / 1.5;
                        // console.log(colorScale.domain().length);
                        bars.enter().append("rect")
                        bars.exit().remove();
                        bars.attr("x", function(d, i, j) {
                                return xScale(d[xColumn]) + barWidth * j;
                            })
                            .attr("y", function(d) {
                                return yScale(d.y);
                            })
                            .attr("width", barWidth)
                            .attr("height", function(d) {
                                return height - yScale(d.y);
                            })
                            .on('mouseover', function(d, i) {
                                d3.select(this)
                                    .style('opacity', .5);
                                tooltip.style('opacity', 0.9)
                                tooltip.html("(" + d[xColumn] + " , " + d3.format('.2s')(d.y) + ")")
                                    .style('left', (d3.event.pageX + 5) + "px")
                                    .style('top', (d3.event.pageY - 28) + "px")
                            }).on('mouseout', function(d) {
                            d3.select(this)
                                .style('opacity', 1)
                            tooltip.style('opacity', 0)
                        });
                        colorLegendG.call(colorLegend);
                        totalObjectArray.length = 0;
                        totalPopulationArray.length = 0;
                    } //end of render
                    render(totalObjectArray);
                } //drawBarChart function ends here

for(var attr in living1){
  queue()
    .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + living1[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
    .await(getLivingCountyData);
  }
  for(var attr in living2){
    queue()
      .defer(d3.json,"http://api.census.gov/data/2015/acs1?get=NAME," + living2[attr] + "&for=" + scselection + ":"+countyNameObj[index].countyID +"&in=state:"+countyNameObj[index].stateID+"&key="+apiKey)
      .await(getLivingCountyData2);
  }

function getLivingCountyData(error,data){
// console.log("in getRaceCountyData");
  var oneObj = {};
  // oneObj.sex = "Female";
  oneObj.ageGroup = "18 to 34 years";
  data.splice(0,1);
  data.forEach(function(index){
    oneObj.population = Math.floor(index[1]);
    livingTotalValues1.push(oneObj.population);
  });

  livingObjArray1.push(oneObj);
    for(var i =0;i<livingObjArray1.length;i++){
        var obj = livingObjArray1[i];
        obj.livingArrangement = livingKey1[i];
      }

    if(livingObjArray1.length === 6){
      drawBarChartCounty(livingObjArray1,livingTotalValues1,'#mainBarChartCounty','livingArrangement','population','ageGroup','arrangement','Population');
    }
}//end function getRaceCountyData

function getLivingCountyData2(error,data){
  // console.log("in getRaceCountyData");
    var oneObj = {};
    // oneObj.sex = "Female";
    oneObj.ageGroup = "35 to 64 years";
    data.splice(0,1);
    data.forEach(function(index){
      // if(index[1] == null){}
      oneObj.population = Math.floor(index[1]);
      livingTotalValues2.push(oneObj.population);
    });

    livingObjArray2.push(oneObj);
    //console.log(raceObjArray);
      for(var i =0;i<livingObjArray2.length;i++){
          var obj = livingObjArray2[i];
          obj.livingArrangement = livingKey2[i];
        }

      if(livingObjArray2.length === 6){
        drawBarChartCounty(livingObjArray2,livingTotalValues2,'#mainBarChartCounty2','livingArrangement','population','ageGroup','arrangement','Population');
      }
  }//end function getRaceCountyData2

// /*********************************************************************************
//                   race distribution on click modal code ends here
// *********************************************************************************/


                            //function drawBarChart begins here
                            function drawBarChartCounty(totalObjectArray, totalPopulationArray, svgId,xCol,yCol,colorCol,xLabel,yLabel) {

                                //clear contents of old chart
                                d3.select(svgId).selectAll('g').remove();

                                var svg = d3.select(svgId);
                                var margin = {
                                    top: 20,
                                    right: 100,
                                    bottom: 100,
                                    left: 40
                                };

                                var width = svg.attr("width") - margin.left - margin.right;
                                var height = svg.attr("height") - margin.top - margin.bottom;

                                var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                                var barPadding = 0;

                                var xColumn = xCol;
                                var yColumn = yCol;
                                var colorColumn = colorCol;
                                var layerColumn = colorColumn;

                                var xScale = d3.scale.ordinal().rangeBands([0, width], barPadding);
                                var yScale = d3.scale.linear().domain([d3.min(totalPopulationArray),
                                    d3.max(totalPopulationArray)
                                ]).range([height, 0]);

                                var colorScale = d3.scale.category10();

                                // add the tooltip area to the webpage
                                var tooltip = d3.select("body").append("div")
                                    .attr("class", "tooltip")
                                    .style("opacity", 0);

                                var xAxis = d3.svg.axis()
                                    .scale(xScale)
                                    .orient('bottom')
                                // .tickValues("transform", "rotate(90)");

                                var yAxis = d3.svg.axis()
                                    .scale(yScale)
                                    .orient('left')
                                    .tickFormat(d3.format('.2s'))

                                var colorLegend = d3.legend.color();

                                colorLegend.scale(colorScale)
                                    .shapePadding(2)
                                    .shapeWidth(14)
                                    .shapeHeight(14)
                                    .labelOffset(4);

                                var xAxisG = g.append("g")
                                    .attr('class', 'x axis')
                                    .attr('transform', 'translate(0,' + height + ')')

                                //.call(xAxis);

                                var yAxisG = g.append("g")
                                    .attr('class', 'y axis')

                                //.call(yAxis);

                                //appending color lengend
                                var colorLegendG = g.append("g")
                                    .attr("class", "color-legend")
                                    .attr("transform", "translate(725,0)");

                                //adding labels
                                g.append("g")
                                    .append("text")
                                    .attr("transform", "rotate(0)")
                                    .attr("x", 5)
                                    .attr("y", -15)
                                    .attr("dy", ".71em")
                                    .style("text-anchor", "end")
                                    .style('font-size', "9px")
                                    .text(yLabel);

                                g.append("g")
                                    .append("text")
                                    .attr("transform", "rotate(0)")
                                    .attr("x", 750)
                                    .attr("y", 180)
                                    .attr("dx", ".71em")
                                    .style("text-anchor", "end")
                                    .style('font-size', "9px")
                                    .text(xLabel);
                                //end of adding labels

                                //render function begins
                                function render(data) {
                                    var nested = d3.nest()
                                        .key(function(d) {
                                            return d[colorColumn]
                                        })
                                        .entries(data);

                                    console.log("barchart nested", nested);

                                    var stack = d3.layout.stack()
                                        .y(function(d) {
                                            return d[yColumn];
                                        })
                                        .values(function(d) {
                                            return d.values;
                                        })

                                    var layers = stack(nested);

                                    console.log("layers", layers);

                                    xScale.domain(layers[0].values.map(function(d) {
                                        return d[xColumn];
                                    }));

                                    colorScale.domain(layers.map(function(layer) {
                                        return layer.key;
                                    }));

                                    xAxisG.call(xAxis).selectAll("text")
                                        .style("text-anchor", "start")
                                        .style("font-size", "9px")
                                        .attr("dx", "0.5em")
                                        .attr("dy", ".15em")
                                        .attr("transform", "rotate(65)");

                                    yAxisG.call(yAxis).selectAll('text').style("font-size", "9px");

                                    var layers = g.selectAll(".layer").data(layers);
                                    layers.enter().append("g").attr("class", "layer");
                                    layers.exit().remove();
                                    layers.style("fill", function(d) {
                                        return colorScale(d.key);
                                    });

                                    var bars = layers.selectAll("rect").data(function(d) {
                                        return d.values;
                                    });

                                    // var barWidth = xScale.rangeBand() / 2 colorScale.domain().length;
                                    var barWidth = xScale.rangeBand() / 1.5;
                                    // console.log(colorScale.domain().length);
                                    bars.enter().append("rect")
                                    bars.exit().remove();
                                    bars.attr("x", function(d, i, j) {
                                            return xScale(d[xColumn]) + barWidth * j;
                                        })
                                        .attr("y", function(d) {
                                            return yScale(d.y);
                                        })
                                        .attr("width", barWidth)
                                        .attr("height", function(d) {
                                            return height - yScale(d.y);
                                        })
                                        .on('mouseover', function(d, i) {
                                            d3.select(this)
                                                .style('opacity', .5);
                                            tooltip.style('opacity', 0.9)
                                            tooltip.html("(" + d[xColumn] + " , " + d3.format('.2s')(d.y) + ")")
                                                .style('left', (d3.event.pageX + 5) + "px")
                                                .style('top', (d3.event.pageY - 28) + "px")
                                        }).on('mouseout', function(d) {
                                        d3.select(this)
                                            .style('opacity', 1)
                                        tooltip.style('opacity', 0)
                                    });
                                    colorLegendG.call(colorLegend);
                                    totalObjectArray.length = 0;
                                    totalPopulationArray.length = 0;
                                } //end of render
                                render(totalObjectArray);
                            } //drawBarChart function ends here

            }); //main click function of county ends here.;

      //  to show state borders as well
        svg.append("g")
            .attr("transform", "translate(0,40)")
            .selectAll("path")
            .data(topojson.feature(us, us.objects.states).features)
            .enter().append("path")
            .attr("d", path)
            .classed("states", "true");
    }
    // else for state selection
    else {

        svg.append("g")
            .attr("class", "legendLinear")
            .attr("transform", "translate(700,80)");

        var legendLinear = d3.legend.color()
            .shapeWidth(30)
            .orient('vertical')
            .cells(10)
            .labelFormat(d3.format('.2s'))
            .scale(quantize);

        /**
         * tooltip code trial
         */
        var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {

                var prop = arr[0][arr[1].indexOf(d.id)];
                console.log(prop);
                var index = parseFloat([arr[1].indexOf(d.id)]);

                console.log("stateNameObjArray Data for tooltip",stateNameObj[index][prop]);

                return "<strong>" + stateNameObj[index][prop] + " : </strong> <span>" + d3.format('.2s')(prop) + "<span>";

            });
        /**
         * tooltip code ends
         */

        svg.call(tip);
        svg.select(".legendLinear")
            .call(legendLinear);

        //to show state borders only
        svg.append("g")
            .attr("transform", "translate(0,40)")
            .selectAll("path")
            .data(topojson.feature(us, us.objects.states).features)
            .enter().append("path")
            .attr("d", path)
            .style("fill", function(d) {
                // console.log("data", d);
                // console.log("data id", arr[1].indexOf(d.id));
                return quantize(arr[0][arr[1].indexOf(d.id)]);
            })
            .classed("states", "true")
            .on("mouseover", tip.show)
            .on("mouseleave", tip.hide)
            .on('click', function(d) {

                var onClickStateName = [];
                var prop = arr[0][arr[1].indexOf(d.id)];
                var index = parseFloat([arr[1].indexOf(d.id)]);
                var stateName = stateNameObj[index][prop];

                //get the selected state Id;
                var idState = stateNameObj[index]['id'];
                console.log("index", stateNameObj[index]);
                console.log(idState);
                onClickStateName.push(stateName);
                console.log(stateName);

                // console.log(this);
                // var singlestateNameObj = {};
                // singlestateNameObj.name = stateName;
                // singlestateNameObj.population = prop;
                var levelTwoVariablesObj = {};
                var levelTwoVariablesObjArray = [];
                var levelTwoVariables = [];
                var acsIdAgeArray = [];
                var totalObjectArray = [];
                var totalPopulationArray = [];
                var levelTwoVariablesCopy = levelTwoVariables;

                console.log(levelTwoVariablesCopy);
                var count = 0;

                function eachStateData(acsId, idState, propName, gender) {
                    var acsIdVariableObj = {};
                    acsIdVariableObj[propName] = acsId;
                    acsIdVariableObj[acsId] = acsId;
                    levelTwoVariablesObjArray.push(acsIdVariableObj);
                    levelTwoVariables.push(propName);
                    $.ajax({
                        url: "http://api.census.gov/data/2015/acs1?get=NAME," + acsId + "&for=state:" + idState + "&key=" + apiKey,
                        crossDomain: true,
                        beforeSend: function() {
                            d3.select('#mainBarChart').selectAll('g').remove();
                            $("#population-count").hide();
                            $('#median-age').hide();
                            $("#spinner").show();

                        },
                        success: function(data) {
                            //count++;
                            // if (levelTwoVariables[count] === arguments[2])
                            console.log("data splice",data);
                            data.splice(0, 1);
                            var singlestateNameObj = {};
                            singlestateNameObj.name = stateName;
                            singlestateNameObj.ageGroup = propName;
                            singlestateNameObj.sex = gender;
                            data.forEach(function(element) {
                                // singlestateNameObj.[propName] = element[1];
                                singlestateNameObj.population = element[1];
                                totalObjectArray.push(singlestateNameObj);
                                totalPopulationArray.push(Math.floor(element[1]));
                            });
                        },
                        complete: function() {
                            if (totalObjectArray.length == 1) {
                                eachStateData('B01001_004E', idState, '5 to 9', 'male');

                            }
                            if (totalObjectArray.length == 2) {
                                eachStateData('B01001_005E', idState, '10 to 14', 'male');

                            }
                            if (totalObjectArray.length == 3) {
                                eachStateData('B01001_006E', idState, '15 to 17', 'male');

                            }
                            if (totalObjectArray.length == 4) {
                                eachStateData('B01001_007E', idState, '18 to 19', 'male');

                            }
                            if (totalObjectArray.length == 5) {
                                eachStateData('B01001_008E', idState, '20', 'male');


                            }
                            if (totalObjectArray.length == 6) {
                                eachStateData('B01001_009E', idState, '21', 'male');

                            }
                            if (totalObjectArray.length == 7) {
                                eachStateData('B01001_010E', idState, '22 to 24', 'male');

                            }
                            if (totalObjectArray.length == 8) {
                                eachStateData('B01001_011E', idState, '25 to 29', 'male');

                            }
                            if (totalObjectArray.length == 9) {
                                eachStateData('B01001_012E', idState, '30 to 34', 'male');

                            }
                            if (totalObjectArray.length == 10) {
                                eachStateData('B01001_013E', idState, '35 to 39', 'male');

                            }
                            if (totalObjectArray.length == 11) {
                                eachStateData('B01001_014E', idState, '40 to 44', 'male');

                            }
                            if (totalObjectArray.length == 12) {
                                eachStateData('B01001_015E', idState, '45 to 49', 'male');

                            }
                            if (totalObjectArray.length == 13) {
                                eachStateData('B01001_016E', idState, '50 to 54', 'male');

                            }
                            if (totalObjectArray.length == 14) {
                                eachStateData('B01001_017E', idState, '55 to 59', 'male');

                            }
                            if (totalObjectArray.length == 15) {
                                eachStateData('B01001_018E', idState, '60 to 61', 'male');

                            }
                            if (totalObjectArray.length == 16) {
                                eachStateData('B01001_019E', idState, '62 to 64', 'male');

                            }
                            if (totalObjectArray.length == 17) {
                                eachStateData('B01001_020E', idState, '65 to 66', 'male');

                            }
                            if (totalObjectArray.length == 18) {
                                eachStateData('B01001_021E', idState, '67 to 69', 'male');

                            }
                            if (totalObjectArray.length == 19) {
                                eachStateData('B01001_022E', idState, '70 to 74', 'male');

                            }
                            if (totalObjectArray.length == 20) {
                                eachStateData('B01001_023E', idState, '75 to 79', 'male');

                            }
                            if (totalObjectArray.length == 21) {
                                eachStateData('B01001_024E', idState, '80 to 84', 'male');

                            }
                            if (totalObjectArray.length == 22) {
                                eachStateData('B01001_025E', idState, '>= 85', 'male');

                            }
                            if (totalObjectArray.length == 23) {
                                eachStateData('B01001_027E', idState, '< 5', 'female');
                                // drawBarChart(totalObjectArray, totalPopulationArray);
                            }
                            if (totalObjectArray.length == 24) {
                                eachStateData('B01001_028E', idState, '5 to 9', 'female');
                            }
                            if (totalObjectArray.length == 25) {
                                eachStateData('B01001_029E', idState, '10 to 14', 'female');
                            }
                            if (totalObjectArray.length == 26) {
                                eachStateData('B01001_030E', idState, '15 to 17', 'female');
                            }
                            if (totalObjectArray.length == 27) {
                                eachStateData('B01001_031E', idState, '18 to 19', 'female');
                            }
                            if (totalObjectArray.length == 28) {
                                eachStateData('B01001_032E', idState, '20', 'female');
                            }
                            if (totalObjectArray.length == 29) {
                                eachStateData('B01001_033E', idState, '21', 'female');
                            }
                            if (totalObjectArray.length == 30) {
                                eachStateData('B01001_034E', idState, '22 to 24', 'female');
                            }
                            if (totalObjectArray.length == 31) {
                                eachStateData('B01001_035E', idState, '25 to 29', 'female');
                            }
                            if (totalObjectArray.length == 32) {
                                eachStateData('B01001_036E', idState, '30 to 34', 'female');
                            }
                            if (totalObjectArray.length == 33) {
                                eachStateData('B01001_037E', idState, '35 to 39', 'female');
                            }
                            if (totalObjectArray.length == 34) {
                                eachStateData('B01001_038E', idState, '40 to 44', 'female');
                            }
                            if (totalObjectArray.length == 35) {
                                eachStateData('B01001_039E', idState, '45 to 49', 'female');
                            }
                            if (totalObjectArray.length == 36) {
                                eachStateData('B01001_040E', idState, '50 to 54', 'female');
                            }
                            if (totalObjectArray.length == 37) {
                                eachStateData('B01001_041E', idState, '55 to 59', 'female');
                            }
                            if (totalObjectArray.length == 38) {
                                eachStateData('B01001_042E', idState, '60 to 61', 'female');
                            }
                            if (totalObjectArray.length == 39) {
                                eachStateData('B01001_043E', idState, '62 to 64', 'female');
                            }
                            if (totalObjectArray.length == 40) {
                                eachStateData('B01001_044E', idState, '65 to 66', 'female');
                            }
                            if (totalObjectArray.length == 41) {
                                eachStateData('B01001_045E', idState, '67 to 69', 'female');
                            }
                            if (totalObjectArray.length == 42) {
                                eachStateData('B01001_046E', idState, '70 to 74', 'female');
                            }
                            if (totalObjectArray.length == 43) {
                                eachStateData('B01001_047E', idState, '75 to 79', 'female');
                            }
                            if (totalObjectArray.length == 44) {
                                eachStateData('B01001_048E', idState, '80 to 84', 'female');
                            }
                            if (totalObjectArray.length == 45) {
                                eachStateData('B01001_049E', idState, '>= 85', 'female');
                            }
                            if (totalObjectArray.length == 46) {
                                console.log(totalObjectArray.length);
                                console.log("totalpopulation array ", totalPopulationArray);
                                drawBarChart(totalObjectArray, totalPopulationArray);
                            }
                        },
                        error: function(jqxhr, textStatus, error) {
                            console.log("error is " + error + " " + textStatus);
                        }
                    });


                } //end of eachStateData function

                //calling function first time
                eachStateData('B01001_003E', idState, '< 5', 'male');

                //modal code - start
                $("#modal-title").text(stateName);
                $("#modal-section").modal('show');
                $("#spinner").hide();
                $("#variableDropDownContainer").hide();
                $('#chart-container').hide();

                function fetchApiData(acsId, stateId) {
                    queue()
                        .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME," + acsId + "&for=state:" + idState + "&key=" + apiKey)
                        .await(displayTotal);
                    // var value = "";
                    // $.ajax({
                    //     url: "http://api.census.gov/data/2015/acs1?get=NAME," + acsId + "&for=state:" + idState + "&key=" + apiKey,
                    //     crossDomain: true,
                    //     beforeSend: function() {
                    //         onlyTotalCount.length = 0;
                    //     },
                    //     success: function(data) {
                    //         onlyTotalCount.length = 0;
                    //         data.splice(0, 1);
                    //         data.forEach(function(val) {
                    //             $('#median-age').show();
                    //             $('#median-age').text("Total Median Age: " + val[1]);
                    //         });
                    //     },
                    //     complete: function() {
                    //         // onlyTotalCount.push(value);
                    //         // console.log(onlyTotalCount[0]);
                    //         // displayTotal(onlyTotalCount);
                    //     }
                    // });

                }

                fetchApiData('B01002_001E', idState);


                function displayTotal(error, value) {
                    $('#median-age').show();
                    value.splice(0, 1);
                    value.forEach(function(val) {
                        $('#median-age').text("Total Median Age: " + val[1]);
                    });
                }

                var medianAgeObjArray = [];

                //function medianAgeData begin
                function medianAgeData(acsId, idState, gender) {

                    var medianObj = {};
                    //var result = fetchApiData(acsId);
                    medianObj.name = stateName;
                    medianObj.sex = gender;
                    $.ajax({
                        url: "http://api.census.gov/data/2015/acs1?get=NAME," + acsId + "&for=state:" + idState + "&key=" + apiKey,
                        crossDomain: true,
                        success: function(data) {
                            data.splice(0, 1);
                            data.forEach(function(val) {
                                medianObj.age = val[1];
                            });
                            medianAgeObjArray.push(medianObj);
                            console.log(medianAgeObjArray);
                        },
                        complete: function() {
                            if (medianAgeObjArray.length == 2) {
                                makePieChart(medianAgeObjArray);
                            }
                        }
                    });

                } //function medianAgeData end

                medianAgeData('B01002_002E', idState, 'male');
                medianAgeData('B01002_003E', idState, 'female');

                //make pie chart function begins
                function makePieChart(medianAgeObjArray) {
                    d3.select("#mainPieChart").remove();
                    $('#median-age').show();


                    var outerWidth = 500;
                    var outerHeight = 250;
                    var margin = {
                        left: 90,
                        top: 30,
                        right: 30,
                        bottom: 30
                    };

                    var radiusMax = 80;
                    var xColumn = "name";
                    var sliceSizeColumn = "age";
                    var colorColumn = "sex";

                    var innerWidth = outerWidth - margin.left - margin.right;
                    var innerHeight = outerHeight - margin.top - margin.bottom;
                    var svg = d3.select("#chart-container").append("svg")
                        .attr("width", outerWidth)
                        .attr("height", outerHeight)
                        .attr("id", "mainPieChart");
                    var g = svg.append("g")
                        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                    var xAxisG = g.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + innerHeight + ")");
                    var pieG = g.append("g");

                    var xScale = d3.scale.ordinal().rangePoints([0, innerWidth]);
                    var colorScale = d3.scale.category10();

                    var xAxis = d3.svg.axis().scale(xScale).orient("bottom")
                        .outerTickSize(0);

                    var pie = d3.layout.pie();
                    var arc = d3.svg.arc();
                    arc.outerRadius(radiusMax);
                    arc.innerRadius(20);

                    function render(data) {

                        xScale.domain(data.map(function(d) {
                            return d[xColumn];
                        }));
                        colorScale.domain(data.map(function(d) {
                            console.log("color column", d[colorColumn]);
                            return d[colorColumn];
                        }));
                        pie.value(function(d) {
                            console.log("pie csilcei ", d[sliceSizeColumn]);
                            var ageValue = d[sliceSizeColumn];
                            var mathFun = Math.floor(ageValue);
                            return d[sliceSizeColumn];
                        });

                        xAxisG.call(xAxis);

                        var pieData = pie(data);

                        pieG.attr("transform", "translate(" + innerWidth / 2 + "," + innerHeight / 2 + ")");

                        var slices = pieG.selectAll("path").data(pieData);
                        slices.enter().append("path");
                        slices.attr("d", arc)
                            .attr("fill", function(d) {
                                return colorScale(d.data[colorColumn]);
                            }).attr("class", "pathFill");
                        slices.exit().remove();

                    }

                    render(medianAgeObjArray);

                } //make pie chart function ends here

                // var svg = d3.select("#mainPieChart");
                // var margin = {
                //     top: 20,
                //     right: 50,
                //     bottom: 20,
                //     left: 70
                // };
                //
                // var width = svg.attr("width") - margin.left - margin.right;
                // var height = svg.attr("height") - margin.top - margin.bottom;
                // var radius = Math.min(width, height) / 2;
                //
                // var color = d3.scale.ordinal()
                //     .range(["#a05d56", "#ff8c00"]);
                //
                // var arc = d3.svg.arc()
                //     .outerRadius(radius - 10)
                //     .innerRadius(0);
                //
                // var labelArc = d3.svg.arc()
                //     .outerRadius(radius - 40)
                //     .innerRadius(radius - 40);
                //
                // var pie = d3.layout.pie()
                //     .sort(null)
                //     .value(function(d) {
                //         return d['age'];
                //     });
                //
                //
                // var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                //
                // var nested = d3.nest()
                //     .key(function(d) {
                //         return d['sex']
                //     })
                //     .entries(medianAgeObjArray);
                // console.log("piechart nested", nested);
                //
                // var g = svg.selectAll(".arc")
                //     .data(pie(nested))
                //     .enter().append("g")
                //     .attr("class", "arc");
                //
                // g.append("path")
                //     .attr("d", arc)
                //     .style("fill", function(d) {
                //         return color(d.age);
                //     });
                //
                // g.append("text")
                //     .attr("transform", function(d) {
                //         return "translate(" + labelArc.centroid(d) + ")";
                //     })
                //     .attr("dy", ".35em")
                //     .text(function(d) {
                //         return d.data[age];
                //     });



                console.log(medianAgeObjArray);

                $("#variableDropDown").on("change", function() {
                    var selectedValue = $('#variableDropDown option:selected').val();
                    //age distribution by sex
                    if (selectedValue == 'B01001_001E') {
                        eachStateData('B01001_003E', idState, '< 5', 'male');
                    }
                });

                //function drawBarChart begins here
                function drawBarChart(totalObjectArray, totalPopulationArray) {

                    $('#chart-container').show();
                    $('#spinner').hide();
                    //clear contents of old chart
                    d3.select('#mainBarChart').selectAll('g').remove();

                    $('#population-count').show();
                    $('#median-age').show();
                    $('#variableDropDownContainer').show();
                    $('#population-count').text("Total Population: " + prop);

                    var svg = d3.select("#mainBarChart");
                    var margin = {
                        top: 40,
                        right: 50,
                        bottom: 100,
                        left: 70
                    };
                    var width = svg.attr("width") - margin.left - margin.right;
                    var height = svg.attr("height") - margin.top - margin.bottom;
                    var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                    var barPadding = .2;

                    var xColumn = "ageGroup";
                    var yColumn = "population";
                    var colorColumn = "sex";
                    var layerColumn = colorColumn;

                    var xScale = d3.scale.ordinal().rangeBands([0, width], barPadding);
                    var yScale = d3.scale.linear().domain([d3.min(totalPopulationArray),
                        d3.max(totalPopulationArray)
                    ]).range([height, 0]);

                    var colorScale = d3.scale.category10();

                    // add the tooltip area to the webpage
                    var tooltip = d3.select("body").append("div")
                        .attr("class", "tooltip")
                        .style("opacity", 0);

                    var xAxis = d3.svg.axis()
                        .scale(xScale)
                        .orient('bottom')
                    // .tickValues("transform", "rotate(90)");

                    var yAxis = d3.svg.axis()
                        .scale(yScale)
                        .orient('left')
                        .tickFormat(d3.format('.2s'))

                    var colorLegend = d3.legend.color();

                    colorLegend.scale(colorScale)
                        .shapePadding(2)
                        .shapeWidth(14)
                        .shapeHeight(14)
                        .labelOffset(4);

                    var xAxisG = g.append("g")
                        .attr('class', 'x axis')
                        .attr('transform', 'translate(0,' + height + ')')

                    //.call(xAxis);

                    var yAxisG = g.append("g")
                        .attr('class', 'y axis')

                    //.call(yAxis);

                    //appending color lengend
                    var colorLegendG = g.append("g")
                        .attr("class", "color-legend")
                        .attr("transform", "translate(600,0)");

                    //adding labels
                    g.append("g")
                        .append("text")
                        .attr("transform", "rotate(0)")
                        .attr("x", 5)
                        .attr("y", -15)
                        .attr("dy", ".71em")
                        .style("text-anchor", "end")
                        .style('font-size', "9px")
                        .text("Population");

                    g.append("g")
                        .append("text")
                        .attr("transform", "rotate(0)")
                        .attr("x", 875)
                        .attr("y", 180)
                        .attr("dx", ".71em")
                        .style("text-anchor", "end")
                        .style('font-size', "9px")
                        .text("Age Group");
                    //end of adding labels

                    //render function begins
                    function render(data) {
                        var nested = d3.nest()
                            .key(function(d) {
                                return d[colorColumn]
                            })
                            .entries(data);

                        console.log("barchart nested", nested);

                        var stack = d3.layout.stack()
                            .y(function(d) {
                                return d[yColumn];
                            })
                            .values(function(d) {
                                return d.values;
                            })

                        var layers = stack(nested);

                        console.log("layers", layers);

                        xScale.domain(layers[0].values.map(function(d) {
                            return d[xColumn];
                        }));

                        colorScale.domain(layers.map(function(layer) {
                            return layer.key;
                        }));

                        xAxisG.call(xAxis).selectAll("text")
                            .style("text-anchor", "start")
                            .style("font-size", "9px")
                            .attr("dx", "0.5em")
                            .attr("dy", ".15em")
                            .attr("transform", "rotate(65)");

                        yAxisG.call(yAxis).selectAll('text').style("font-size", "9px");

                        var layers = g.selectAll(".layer").data(layers);
                        layers.enter().append("g").attr("class", "layer");
                        layers.exit().remove();
                        layers.style("fill", function(d) {
                            return colorScale(d.key);
                        });


                        var bars = layers.selectAll("rect").data(function(d) {
                            return d.values;
                        });

                        // var barWidth = xScale.rangeBand() / 2 colorScale.domain().length;
                        var barWidth = xScale.rangeBand() / 2.5;
                        // console.log(colorScale.domain().length);
                        bars.enter().append("rect")
                        bars.exit().remove();
                        bars.attr("x", function(d, i, j) {
                                return xScale(d[xColumn]) + barWidth * j;
                            })
                            .attr("y", function(d) {
                                return yScale(d.y);
                            })
                            .attr("width", barWidth)
                            .attr("height", function(d) {
                                return height - yScale(d.y);
                            })
                            .on('mouseover', function(d, i) {
                                d3.select(this)
                                    .style('opacity', .5);
                                tooltip.style('opacity', 0.9)
                                tooltip.html("(" + d[xColumn] + " , " + d3.format('.2s')(d.y) + ")")
                                    .style('left', (d3.event.pageX + 5) + "px")
                                    .style('top', (d3.event.pageY - 28) + "px")
                            }).on('mouseout', function(d) {
                            d3.select(this)
                                .style('opacity', 1)
                            tooltip.style('opacity', 0)
                        });
                        colorLegendG.call(colorLegend);
                        totalObjectArray.length = 0;
                        totalPopulationArray.length = 0;
                    } //end of render
                    render(totalObjectArray);

                } //drawBarChart function ends here


            });

    }
    pieChart("pie1");
}//elusive drawMap function ends here.

function pieChart(pienumber) {
    var svg1 = d3.select("#pie1");
    var svg2 = d3.select("#pie2");
    var svg3 = d3.select("#pie3");

    if (dataselection.indexOf("B01003_0") == 0) {
        val = "B01003_001E";
        svg1.selectAll('g').remove();
        svg2.selectAll('g').remove();
        svg3.selectAll('g').remove();
    } else
    if (dataselection.indexOf("B01001_0") == 0) {
        //val = "B01001_001E";

        if (dataselection.indexOf("001E") != -1) {
            codes = ["B01001_002E", "B01001_026E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Male", "Female"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }
                    svg1.selectAll('g').remove();
                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie1", data)
                });
        } else
        if (dataselection.indexOf("002E") != -1) {
            codes = ["B01001_003E", "B01001_004E", "B01001_005E", "B01001_006E", "B01001_007E", "B01001_008E", "B01001_009E", "B01001_010E", "B01001_011E", "B01001_012E", "B01001_013E", "B01001_014E", "B01001_015E", "B01001_016E", "B01001_017E", "B01001_018E", "B01001_019E", "B01001_020E", "B01001_021E", "B01001_022E", "B01001_023E", "B01001_024E", "B01001_025E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Under 5 Years", "5 to 9 Years", "10 to 14 Years", "15 to 17 Years", "18 and 19 Years", "20 Years", "21 Years", "22 to 24 Years", "25 to 29 Years", "30 to 34 Years", "35 to 39 Years", "40 to 44 Years", "45 to 49 Years", "50 to 54 Years", "55 to 59 Years", "60 and 61 Years", "62 to 64 Years", "65 and 66 Years", "67 to 69 Years", "70 to 74 Years", "75 to 79 Years", "80 to 84 Years", "85 Years and over"];
                    data1.splice(0, 1);
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
        } else
        if (dataselection.indexOf("026E") != -1) {
            codes = ["B01001_027E", "B01001_028E", "B01001_029E", "B01001_030E", "B01001_031E", "B01001_032E", "B01001_033E", "B01001_034E", "B01001_035E", "B01001_036E", "B01001_037E", "B01001_038E", "B01001_039E", "B01001_040E", "B01001_041E", "B01001_042E", "B01001_043E", "B01001_044E", "B01001_045E", "B01001_046E", "B01001_047E", "B01001_048E", "B01001_049E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Under 5 Years", "5 to 9 Years", "10 to 14 Years", "15 to 17 Years", "18 and 19 Years", "20 Years", "21 Years", "22 to 24 Years", "25 to 29 Years", "30 to 34 Years", "35 to 39 Years", "40 to 44 Years", "45 to 49 Years", "50 to 54 Years", "55 to 59 Years", "60 and 61 Years", "62 to 64 Years", "65 and 66 Years", "67 to 69 Years", "70 to 74 Years", "75 to 79 Years", "80 to 84 Years", "85 Years and over"];
                    data1.splice(0, 1);
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
            /*queue()
             .defer(d3.json, "
             http://api.census.gov/data/2015/acs1?get=NAME,B01001_027E,B01001_028E,B01001_029E,B01001_030E,B01001_031E,B01001_032E,B01001_033E,B01001_034E,B01001_035E,B01001_036E,B01001_037E,B01001_038E,B01001_039E,B01001_040E,B01001_041E,B01001_042E,B01001_043E,B01001_044E,B01001_045E,B01001_046E,B01001_047E,B01001_048E,B01001_049E&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09")
             http://api.census.gov/data/2015/acs1?get=NAME,B01001_027E,B01001_028E,B01001_029E,B01001_030E,B01001_031E,B01001_032E,B01001_033E,B01001_034E,B01001_035E,B01001_036E,B01001_037E,B01001_038E,B01001_039E,B01001_040E,B01001_041E,B01001_042E,B01001_043E,B01001_044E,B01001_045E,B01001_046E,B01001_047E,B01001_048E,B01001_049E&for=state:*&key=              576299d4Bf73993515a4994ffe79fcee7fe72B09"
             .await(function (error, data1) {
             var sum = 0;
             var data = [];
             var labelarray = ["Under 5 Years", "5 to 9 Years", "10 to 14 Years", "15 to 17 Years", "18 and 19 Years", "20 Years", "21 Years", "22 to 24 Years", "25 to 29 Years", "30 to 34 Years", "35 to 39 Years", "40 to 44 Years", "45 to 49 Years", "50 to 54 Years", "55 to 59 Years", "60 and 61 Years", "62 to 64 Years", "65 and 66 Years", "67 to 69 Years", "70 to 74 Years", "75 to 79 Years", "80 to 84 Years", "85 Years and over"];
             data1.splice(0, 1);
             for(var i = 1;i<22;i++) {
             data1.forEach(function (elem) {
             if (elem[i] != null)
             sum += parseInt(elem[i]);
             });
             data.push({
             label:labelarray[i-1],
             val: sum
             });
             sum = 0;
             }

             drawPieChart(pienumber, data)
             });
             */
        }
    } else
    if (dataselection.indexOf("B01002_0") == 0) {

        if (dataselection.indexOf("001E") != -1) {
            codes = ["B01002_002E", "B01002_003E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Male", "Female"];
                    data1.splice(0, 1);
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }
                    svg1.selectAll('g').remove();
                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie1", data)
                });
        }
    } else
    if (dataselection.indexOf("B02001_0") == 0) {
        if (dataselection.indexOf("001E") != -1) {
            codes = ["B02001_002E", "B02001_003E", "B02001_004E", "B02001_005E", "B02001_006E", "B02001_007E", "B02001_008E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["White Alone", "Black or African American Alone", "American Indian and Alaska Native Alone", "Asian Alone", "Native Hawaiian and Other Pacific Islander Alone", "Some Other Race Alone", "Two or More Races"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }
                    svg1.selectAll('g').remove();
                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie1", data)
                });
        } else
        if (dataselection.indexOf("008E") != -1) {
            codes = ["B02001_009R", "B02001_010E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Two Races Including Some Other Race", "Two Races Excluding Some Other Race, and Three or More Races"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
        }
    } else
    if (dataselection.indexOf("B09021_0") == 0) {
        if (dataselection.indexOf("001E") != -1) {
            codesfor3 = ["B09021_002E", "B09021_003E", "B09021_004E", "B09021_005E", "B09021_006E", "B09021_007E"]
            codesfor2 = ["B09021_008E", "B09021_015E", "B09021_022E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codesfor2.length; i++) {
                querystr = querystr + "," + codesfor2[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            querystr1 = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codesfor3.length; i++) {
                querystr1 = querystr1 + "," + codesfor3[i];
            }
            querystr1 = querystr1 + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .defer(d3.json, querystr1)
                .await(function(error, data1, data11) {
                    var sum = 0;
                    var data2 = [];
                    var data3 = [];

                    var labelarray2 = ["18 to 34 Years", "35 to 64 Years", "65 Years and over"];
                    var labelarray3 = ["Lives Alone", "Householder Living With Spouse or Spouse of Householder", "Householder Living With Unmarried Partner or Unmarried Partner of Householder", "Child of Householder", "Other Relatives", "Other Nonrelatives"];
                    data1.splice(0, 1);
                    data11.splice(0, 1);

                    for (var i = 1; i < codesfor2.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data2.push({
                            label: labelarray2[i - 1],
                            val: sum,
                            code: codesfor2[i - 1]
                        });
                        sum = 0;
                    }
                    for (var i = 1; i < codesfor3.length + 1; i++) {
                        data11.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data3.push({
                            label: labelarray3[i - 1],
                            val: sum,
                            code: codesfor3[i - 1]
                        });
                        sum = 0;
                    }
                    svg1.selectAll('g').remove();
                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();

                    drawPieChart("pie1", data2);
                    drawPieChart("pie2", data3);
                });
        } else {
            if (dataselection.indexOf("008E") != -1) {
                codes = ["B09021_009E", "B09021_010E", "B09021_011E", "B09021_012E", "B09021_013E", "B09021_014E"];
            } else
            if (dataselection.indexOf("015E") != -1) {
                codes = ["B09021_016E", "B09021_017E", "B09021_018E", "B09021_019E", "B09021_020E", "B09021_021E"];
            } else
            if (dataselection.indexOf("022E") != -1) {
                codes = ["B09021_023E", "B09021_024E", "B09021_025E", "B09021_026E", "B09021_027E", "B09021_028E"];
            }
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Lives Alone", "Householder Living With Spouse or Spouse of Householder", "Householder Living With Unmarried Partner or Unmarried Partner of Householder", "Child of Householder", "Other Relatives", "Other Nonrelatives"];

                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
        }

    } else
    if (dataselection.indexOf("C05002_0") == 0) {
        if (dataselection.indexOf("001E") != -1) {
            codes = ["C05002_002E", "C05002_008E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Native", "Foreign Born"];
                    data1.splice(0, 1);
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }
                    svg1.selectAll('g').remove();
                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie1", data)
                });
        } else
        if (dataselection.indexOf("002E") != -1) {
            codes = ["C05002_003E", "C05002_004E", "C05002_005E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Born in State of Residence", "Born in Other State in the United States", "Born Outside the United States"];
                    data1.splice(0, 1);
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
        } else
        if (dataselection.indexOf("005E") != -1) {
            codes = ["C05002_006E", "C05002_007E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Puerto Rico", "U.s. Island Areas or Born Abroad of American Parent(S)"];
                    data1.splice(0, 1);
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg3.selectAll('g').remove();
                    drawPieChart("pie3", data)
                });
        }

    } else
    if (dataselection.indexOf("B19013_0") == 0) {
        val = "B19013_001E";
        svg1.selectAll('g').remove();
        svg2.selectAll('g').remove();
        svg3.selectAll('g').remove();
    } else
    if (dataselection.indexOf("B19301_0") == 0) {
        svg1.selectAll('g').remove();
        svg2.selectAll('g').remove();
        svg3.selectAll('g').remove();
        val = "B19301_001E";
    } else
    if (dataselection.indexOf("B17002_0") == 0) {
        if (dataselection.indexOf("001E") != -1) {

            codes = ["B17002_002E", "B17002_003E", "B17002_004E", "B17002_005E", "B17002_006E", "B17002_007E", "B17002_008E", "B17002_009E", "B17002_010E", "B17002_011E", "B17002_012E", "B17002_013E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Under .50", ".50 to .74", ".75 to .99", "1.00 to 1.24", "1.25 to 1.49", "1.50 to 1.74", "1.75 to 1.84", "1.85 to 1.99", "2.00 to 2.99", "3.00 to 3.99", "4.00 to 4.99", "5.00 and over"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }
                    svg1.selectAll('g').remove();
                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie1", data)
                });
        }
    } else
    if (dataselection.indexOf("B06012_0") == 0) {
        if (dataselection.indexOf("001E") != -1) {
            codesfor3 = ["B06012_002E", "B06012_003E", "B06012_004E"];
            codesfor2 = ["B06012_005E", "B06012_009E", "B06012_013E", "B06012_017E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codesfor3.length; i++) {
                querystr = querystr + "," + codesfor3[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            querystr1 = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codesfor2.length; i++) {
                querystr1 = querystr1 + "," + codesfor2[i];
            }
            querystr1 = querystr1 + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .defer(d3.json, querystr1)
                .await(function(error, data1, data11) {
                    var sum = 0;
                    var data3 = [];
                    var data2 = [];
                    data1.splice(0, 1);
                    data11.splice(0, 1);

                    var labelarray3 = ["Below 100 Percent of the Poverty Level", "100 to 149 Percent of the Poverty Level", "At or Above 150 Percent of the Poverty Level"];
                    var labelarray2 = ["Born in State of Residence", "Born in Other State in the United States", "Native; Born Outside the United States", "Foreign Born"];
                    for (var i = 1; i < codesfor3.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data3.push({
                            label: labelarray3[i - 1],
                            val: sum,
                            code: codesfor3[i - 1]
                        });
                        sum = 0;
                    }

                    for (var i = 1; i < codesfor2.length + 1; i++) {
                        data11.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data2.push({
                            label: labelarray2[i - 1],
                            val: sum,
                            code: codesfor2[i - 1]
                        });
                        sum = 0;
                    }
                    svg1.selectAll('g').remove();
                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie1", data2)
                    drawPieChart("pie2", data3)
                });

        } else
        if (dataselection.indexOf("005E") != -1) {
            codes = ["B06012_006E", "B06012_007E", "B06012_008E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Below 100 Percent of the Poverty Level", "100 to 149 Percent of the Poverty Level", "At or Above 150 Percent of the Poverty Level"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
        } else
        if (dataselection.indexOf("009E") != -1) {
            codes = ["B06012_010E", "B06012_011E", "B06012_012E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Below 100 Percent of the Poverty Level", "100 to 149 Percent of the Poverty Level", "At or Above 150 Percent of the Poverty Level"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
        } else
        if (dataselection.indexOf("013E") != -1) {
            codes = ["B06012_014E", "B06012_015E", "B06012_016E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Below 100 Percent of the Poverty Level", "100 to 149 Percent of the Poverty Level", "At or Above 150 Percent of the Poverty Level"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
        } else
        if (dataselection.indexOf("017E") != -1) {
            codes = ["B06012_018E", "B06012_019E", "B06012_020E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Below 100 Percent of the Poverty Level", "100 to 149 Percent of the Poverty Level", "At or Above 150 Percent of the Poverty Level"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
        }
    } else
    if (dataselection.indexOf("B06009_0") == 0) {
        if (dataselection.indexOf("001E") != -1) {
            codesfor3=["B06009_002E","B06009_003E","B06009_004E","B06009_005E","B06009_006E"];
            codesfor2=["B06009_007E","B06009_013E","B06009_019E","B06009_025E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for(var i =0;i<codesfor3.length;i++){
                querystr = querystr + "," + codesfor3[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            querystr1 = "http://api.census.gov/data/2015/acs1?get=NAME";
            for(var i =0;i<codesfor2.length;i++){
                querystr1 = querystr1 + "," + codesfor2[i];
            }
            querystr1 = querystr1 + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json,querystr )
                .defer(d3.json,querystr1 )
                .await(function (error, data1, data11) {
                    var sum = 0;
                    var data3 = [];
                    var data2 = [];
                    data1.splice(0, 1);
                    data11.splice(0, 1);


                    var labelarray3 = ["Less than High School Graduate","High School Graduate (Includes Equivalency)","Some College or Associate's Degree","Bachelor's Degree","Graduate or Professional Degree"];
                    var labelarray2 = ["Born in State of Residence","Born in Other State in the United States","Native; Born Outside the United States","Foreign Born"];
                    for(var i = 1;i<codesfor3.length +1;i++) {
                        data1.forEach(function (elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data3.push({
                            label:labelarray3[i-1],
                            val: sum,
                            code: codesfor3[i-1]
                        });
                        sum = 0;
                    }

                    for(var i = 1;i<codesfor2.length +1;i++) {
                        data11.forEach(function (elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data2.push({
                            label:labelarray2[i-1],
                            val: sum,
                            code: codesfor2[i-1]
                        });
                        sum = 0;
                    }
                    drawPieChart("pie1", data2)
                    drawPieChart("pie2", data3)
                });
        }else
        if (dataselection.indexOf("007E") != -1) {
            codes=["B06009_008E","B06009_009E","B06009_010E","B06009_011E","B06009_012E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for(var i =0;i<codes.length;i++){
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json,querystr )
                .await(function (error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Less than High School Graduate","High School Graduate (Includes Equivalency)","Some College or Associate's Degree","Bachelor's Degree","Graduate or Professional Degree"];
                    for(var i = 1;i<codes.length +1;i++) {
                        data1.forEach(function (elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label:labelarray[i-1],
                            val: sum,
                            code: codes[i-1]
                        });
                        sum = 0;
                    }
                    drawPieChart(pienumber, data)
                });
        } else
        if (dataselection.indexOf("013E") != -1) {
            codes=["B06009_014E","B06009_015E","B06009_016E","B06009_017E","B06009_018E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for(var i =0;i<codes.length;i++){
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json,querystr )
                .await(function (error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Less than High School Graduate","High School Graduate (Includes Equivalency)","Some College or Associate's Degree","Bachelor's Degree","Graduate or Professional Degree"];
                    for(var i = 1;i<codes.length +1;i++) {
                        data1.forEach(function (elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label:labelarray[i-1],
                            val: sum,
                            code: codes[i-1]
                        });
                        sum = 0;
                    }
                    drawPieChart(pienumber, data)
                });
        } else
        if (dataselection.indexOf("019E") != -1) {
            codes=["B06009_020E","B06009_021E","B06009_022E","B06009_023E","B06009_024E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for(var i =0;i<codes.length;i++){
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json,querystr )
                .await(function (error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Below 100 Percent of the Poverty Level","100 to 149 Percent of the Poverty Level","At or Above 150 Percent of the Poverty Level"];
                    for(var i = 1;i<codes.length +1;i++) {
                        data1.forEach(function (elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label:labelarray[i-1],
                            val: sum,
                            code: codes[i-1]
                        });
                        sum = 0;
                    }
                    drawPieChart(pienumber, data)
                });
        } else
        if (dataselection.indexOf("025E") != -1) {
            codes=["B06009_026E","B06009_027E","B06009_028E","B06009_029E","B06009_030E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for(var i =0;i<codes.length;i++){
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json,querystr )
                .await(function (error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Below 100 Percent of the Poverty Level","100 to 149 Percent of the Poverty Level","At or Above 150 Percent of the Poverty Level"];
                    for(var i = 1;i<codes.length +1;i++) {
                        data1.forEach(function (elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label:labelarray[i-1],
                            val: sum,
                            code: codes[i-1]
                        });
                        sum = 0;
                    }
                    drawPieChart(pienumber, data)
                });
        }
    } else
    if (dataselection.indexOf("B08303_0") == 0) {
        if (dataselection.indexOf("001E") != -1) {


            codes = ["B08303_002E", "B08303_003E", "B08303_004E", "B08303_005E", "B08303_006E", "B08303_007E", "B08303_008E", "B08303_009E", "B08303_010E", "B08303_011E", "B08303_012E", "B08303_013E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Less than 5 Minutes", "5 to 9 Minutes", "10 to 14 Minutes", "15 to 19 Minutes", "20 to 24 Minutes", "25 to 29 Minutes", "30 to 34 Minutes", "35 to 39 Minutes", "40 to 44 Minutes", "45 to 59 Minutes", "60 to 89 Minutes", "90 or More Minutes"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }
                    svg1.selectAll('g').remove();
                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie1", data)
                });

        }
    } else
    if (dataselection.indexOf("B08301_0") == 0) {
        if (dataselection.indexOf("001E") != -1) {
            codes = ["B08301_002E", "B08301_010E", "B08301_016E", "B08301_017E", "B08301_018E", "B08301_019E", "B08301_020E", "B08301_021E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Car, Truck, or Van", "Public Transportation (Excluding Taxicab)", "Taxicab", "Motorcycle", "Bicycle", "Walked", "Other Means", "Worked at Home"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }
                    svg1.selectAll('g').remove();
                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie1", data)
                });
        } else
        if (dataselection.indexOf("002E") != -1) {
            codes = ["B08301_003E", "B08301_004E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Drove Alone", "Carpooled"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
        } else
        if (dataselection.indexOf("004E") != -1) {
            codes = ["B08301_005E", "B08301_006E", "B08301_007E", "B08301_008E", "B08301_009E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["In 2-Person Carpool", "In 3-Person Carpool", "In 4-Person Carpool", "In 5- or 6-Person Carpool", "In 7-or-More-Person Carpool"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg3.selectAll('g').remove();
                    drawPieChart("pie3", data)
                });
        } else
        if (dataselection.indexOf("010E") != -1) {
            codes = ["B08301_011E", "B08301_012E", "B08301_013E", "B08301_014E", "B08301_015E"];
            querystr = "http://api.census.gov/data/2015/acs1?get=NAME";
            for (var i = 0; i < codes.length; i++) {
                querystr = querystr + "," + codes[i];
            }
            querystr = querystr + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09";
            queue()
                .defer(d3.json, querystr)
                .await(function(error, data1) {
                    var sum = 0;
                    var data = [];
                    data1.splice(0, 1);
                    var labelarray = ["Bus or Trolley Bus", "Streetcar or Trolley Car (Carro Publico in Puerto Rico)", "Subway or Elevated", "Railroad", "Ferryboat"];
                    for (var i = 1; i < codes.length + 1; i++) {
                        data1.forEach(function(elem) {
                            if (elem[i] != null)
                                sum += parseInt(elem[i]);
                        });
                        data.push({
                            label: labelarray[i - 1],
                            val: sum,
                            code: codes[i - 1]
                        });
                        sum = 0;
                    }

                    svg2.selectAll('g').remove();
                    svg3.selectAll('g').remove();
                    drawPieChart("pie2", data)
                });
        }

    }
}

function drawPieChart(pienumber, data1) {

    var width = window.height * 0.5,
        height = window.height * 0.5,
        radius = Math.min(width, height) / 2;


    //ordinal scale to have different colors for different sections
    var color = d3.scale.ordinal()
        .range(['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00', '#cab2d6', '#6a3d9a', '#ffff99', '#b15928']);

    var arc = d3.svg.arc()
        .outerRadius(radius - 10)
        .innerRadius(radius - 100);

    var pie = d3.layout.pie()
        .sort(null)
        .value(function(d) {
            return d.val;
        });

    var svg1 = d3.select("#" + pienumber);
    svg1.selectAll('g').remove();

    var piegroup = svg1.append("g")
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    var path = piegroup.selectAll('path')
        .data(pie(data1))
        .enter()
        .append('path')
        .attr('d', arc)
        .style('fill', function(d) {
            return color(d.data.label);
        })
        .on("click", function(d) {
            var str = d.data.code;
            dataselection = str; //.slice(0, 6) + "_" + str.slice(6 , 9)+"E";
            var t = $('#level1dataset input:radio:checked').val();
            $("#" + t + " input:radio:checked").attr("checked", "false");
            $("#" + t + " input:radio:checked").parent().removeClass("active");
            $("#" + t + " [value=" + dataselection + "]").attr("checked", "true");
            $("#" + t + " [value=" + dataselection + "]").parent().addClass("active");


            scselection = $('#disptype input:radio:checked').val();
            queue()
                .defer(d3.json, "http://api.census.gov/data/2015/acs1?get=NAME," + dataselection + "&for=" + scselection + ":*&key=576299d4bf73993515a4994ffe79fcee7fe72b09")
                .await(drawMap);
        });
    /*working
     var g = piegroup.selectAll(".arc")
     .data(pie(data1))
     .enter()
     .append("g")
     .attr("class", "arc");

     g.append("path")
     .attr("d", arc)
     .style("fill", function(d) {
     return color(d.data.label);
     });
     */
    /*g.append("text")
     .attr("transform", function(d) { return "translate(" + arc.centroid(d) + ")"; })
     .attr("dy", ".35em")
     .text(function(d) { return d.data.label; });
     */

    function type(d) {
        d.population = +d.population;
        return d;
    }
}
